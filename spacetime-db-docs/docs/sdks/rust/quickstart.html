<!DOCTYPE html><html lang="en">
<!-- Mirrored from spacetimedb.com/docs/sdks/rust/quickstart by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 May 2025 02:58:44 GMT -->
<head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="../../../favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="../../../favicon-16x16.png"/><link rel="manifest" href="../../../site.webmanifest"/><link rel="mask-icon" href="../../../safari-pinned-tab.svg" color="#202126"/><meta name="msapplication-TileColor" content="#202126"/><meta name="theme-color" content="#202126"/><link href="../../../favicon-light.ico" rel="icon" media="(prefers-color-scheme: light)"/><link href="../../../favicon.ico" rel="icon" media="(prefers-color-scheme: dark)"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="title" content="SpacetimeDB"/><meta name="description" content="Multiplayer at the speed of light."/><meta property="og:type" content="website"/><meta property="og:url" content="../../../index.html"/><meta property="og:title" content="SpacetimeDB"/><meta property="og:description" content="Multiplayer at the speed of light."/><meta property="og:image" content="../../../meta-tags.png"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="../../../index.html"/><meta property="twitter:title" content="SpacetimeDB"/><meta property="twitter:description" content="Multiplayer at the speed of light."/><meta property="twitter:image" content="../../../meta-tags.png"/><link rel="preload" as="font" href="../../../assets/ibm-plex-mono-latin-600-normal-rgB1DpUr.woff2" type="font/woff2" crossorigin="anonymous"/><link rel="preload" as="font" href="../../../assets/inter-latin-wght-normal-C2S99t-D.woff2" type="font/woff2" crossorigin="anonymous"/><link rel="preload" as="font" href="../../../assets/source-code-pro-latin-wght-normal-C54hYqvT.woff2" type="font/woff2" crossorigin="anonymous"/><title>Docs | SpacetimeDB</title><link rel="stylesheet" href="../../../assets/root-DgiNzMOf.css"/><link rel="stylesheet" href="../../../assets/Layout-CTL7f1Hd.css"/><link rel="stylesheet" href="../../../assets/Container-_6nMI5g_.css"/><link rel="stylesheet" href="../../../assets/Button-C8_kLgtz.css"/><link rel="stylesheet" href="../../../assets/route-DfbkRanz.css"/><link rel="stylesheet" href="../../../assets/ScrollAnimation-HNI5Nioi.css"/><link rel="stylesheet" href="../../../assets/route-DPGvI9WQ.css"/><link rel="stylesheet" href="../../../assets/MDComponent-CdQtYgZs.css"/></head><body><div style="position:fixed;z-index:9999;top:16px;left:16px;right:16px;bottom:16px;pointer-events:none"></div><div id="root"><div><div class="BPQwEa_scrollScapegoat"></div><header class="BPQwEa_header" style="--background:transparent;--color-border:transparent"><div class="sDndEq_announcementBanner text-tagline-1"><div class="wtWGoa_root"><div class="sDndEq_content"><div class="sDndEq_left"><svg class="sDndEq_announcementIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.2413 2H7.7587C6.95374 1.99999 6.28937 1.99998 5.74818 2.04419C5.18608 2.09012 4.66937 2.18868 4.18404 2.43598C3.43139 2.81947 2.81947 3.43139 2.43598 4.18404C2.18868 4.66937 2.09012 5.18608 2.04419 5.74818C1.99998 6.28937 1.99999 6.95372 2 7.75869V13.5343C1.99999 14.2041 1.99999 14.7569 2.03087 15.2095C2.06289 15.6788 2.13142 16.1129 2.30448 16.5307C2.71046 17.5108 3.48916 18.2895 4.46927 18.6955C4.88708 18.8686 5.32118 18.9371 5.79046 18.9691C6.24307 19 6.79594 19 7.46573 19H7.5C8.03656 19 8.14307 19.0063 8.22975 19.0268C8.38085 19.0624 8.52156 19.1328 8.64075 19.2322C8.70913 19.2893 8.77806 19.3708 9.1 19.8L10.5769 21.7692C10.6703 21.8938 10.7758 22.0346 10.8774 22.1476C10.9894 22.2721 11.1756 22.4555 11.4563 22.5647C11.806 22.7007 12.194 22.7007 12.5437 22.5647C12.8244 22.4555 13.0106 22.2721 13.1226 22.1476C13.2242 22.0346 13.3297 21.8938 13.4231 21.7692L14.9 19.8C15.2219 19.3708 15.2909 19.2893 15.3593 19.2322C15.4784 19.1328 15.6192 19.0624 15.7702 19.0268C15.8569 19.0063 15.9634 19 16.5 19H16.5343C17.2041 19 17.7569 19 18.2095 18.9691C18.6788 18.9371 19.1129 18.8686 19.5307 18.6955C20.5108 18.2895 21.2895 17.5108 21.6955 16.5307C21.8686 16.1129 21.9371 15.6788 21.9691 15.2095C22 14.7569 22 14.2041 22 13.5343V7.75868C22 6.95372 22 6.28937 21.9558 5.74818C21.9099 5.18608 21.8113 4.66937 21.564 4.18404C21.1805 3.43139 20.5686 2.81947 19.816 2.43598C19.3306 2.18868 18.8139 2.09012 18.2518 2.04419C17.7106 1.99998 17.0463 1.99999 16.2413 2ZM13 7C13 6.44772 12.5523 6 12 6C11.4477 6 11 6.44772 11 7V10.5C11 11.0523 11.4477 11.5 12 11.5C12.5523 11.5 13 11.0523 13 10.5V7ZM12 13C11.4477 13 11 13.4477 11 14C11 14.5523 11.4477 15 12 15H12.01C12.5623 15 13.01 14.5523 13.01 14C13.01 13.4477 12.5623 13 12.01 13H12Z" fill="#4CF490"></path></svg><p class="md-body-docs">Maincloud is now <b>LIVE</b>! Get Maincloud Energy 90% off until we run out!</p></div><form method="post" action="https://spacetimedb.com/api/announcement-banner"><button aria-label="Close announcement banner"><svg class="dismiss-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM15.7071 8.29289C16.0976 8.68342 16.0976 9.31658 15.7071 9.70711L13.4142 12L15.7071 14.2929C16.0976 14.6834 16.0976 15.3166 15.7071 15.7071C15.3166 16.0976 14.6834 16.0976 14.2929 15.7071L12 13.4142L9.70711 15.7071C9.31658 16.0976 8.68342 16.0976 8.29289 15.7071C7.90237 15.3166 7.90237 14.6834 8.29289 14.2929L10.5858 12L8.29289 9.70711C7.90237 9.31658 7.90237 8.68342 8.29289 8.29289C8.68342 7.90237 9.31658 7.90237 9.70711 8.29289L12 10.5858L14.2929 8.29289C14.6834 7.90237 15.3166 7.90237 15.7071 8.29289Z" fill="#A4CBB4"></path></svg></button></form></div></div></div><div class="wtWGoa_root"><div class="BPQwEa_inner" style="--padding:24px 0"><a class="BPQwEa_brand BPQwEa_hideMobile" data-discover="true" href="../../../home.html"><img src="../../../images/brand.png" alt="SpacetimeDB" width="390" height="96"/></a><a class="BPQwEa_logo BPQwEa_hideDesktop" data-discover="true" href="../../../home.html"><img src="../../../images/logo.png" alt="SpacetimeDB" width="36" height="36"/></a><div class="BPQwEa_versionTag text-value-3"><p>v1.1</p></div><nav class="BPQwEa_nav text-menu BPQwEa_hideMobile"><a data-discover="true" class="" href="../../../install.html">Install</a><a data-discover="true" class="" href="../../../pricing.html">Pricing</a><a data-discover="true" class="" href="../../../maincloud.html">Maincloud</a><a data-discover="true" aria-current="page" class="BPQwEa_active" href="../../../docs.html">Docs</a><a data-discover="true" class="" href="../../../blog.html">Blog</a><a data-discover="true" class="" href="../../../community.html">Community</a></nav><button cy-data="" class="GM6BWG_button GM6BWG_primary BPQwEa_hideMobile BPQwEa_starUsBtn text-menu" aria-label="16K stars" type="button"><svg class="GM6BWG_leftIcon" style="min-width:20px" fill="none" width="20" height="20" viewBox="0 0 20 20"><path d="M8.12384 7.08774C7.87849 6.97075 7.59345 6.97075 7.3481 7.08774C7.136 7.18886 7.01906 7.36444 6.96009 7.46077C6.89912 7.56035 6.83654 7.6872 6.77554 7.81084L5.48033 10.4348L2.58314 10.8583C2.44676 10.8782 2.30682 10.8986 2.19332 10.9259C2.08351 10.9523 1.88049 11.0094 1.71892 11.1799C1.53201 11.3772 1.44411 11.6483 1.47969 11.9178C1.51044 12.1507 1.64133 12.316 1.71475 12.4018C1.79064 12.4905 1.89197 12.5892 1.99073 12.6854L4.08627 14.7264L3.59181 17.6093C3.56847 17.7452 3.54452 17.8847 3.53531 18.0011C3.52639 18.1137 3.51777 18.3245 3.62995 18.5311C3.7597 18.7699 3.99034 18.9375 4.25762 18.987C4.4887 19.0299 4.68654 18.9565 4.79087 18.9132C4.89875 18.8684 5.02397 18.8026 5.14603 18.7383L7.73597 17.3763L10.3259 18.7383C10.448 18.8026 10.5732 18.8685 10.6811 18.9132C10.7854 18.9565 10.9832 19.0299 11.2143 18.987C11.4816 18.9375 11.7122 18.7699 11.842 18.5311C11.9542 18.3245 11.9455 18.1137 11.9366 18.0011C11.9274 17.8847 11.9035 17.7453 11.8801 17.6093L11.3857 14.7264L13.4812 12.6853C13.58 12.5892 13.6813 12.4905 13.7572 12.4018C13.8306 12.316 13.9615 12.1507 13.9922 11.9178C14.0278 11.6483 13.9399 11.3772 13.753 11.1799C13.5914 11.0094 13.3884 10.9523 13.2786 10.9259C13.1651 10.8986 13.0252 10.8782 12.8888 10.8583L9.99161 10.4348L8.69642 7.81089C8.63542 7.68724 8.57282 7.56036 8.51185 7.46077C8.45288 7.36444 8.33594 7.18886 8.12384 7.08774Z" fill="currentColor" stroke="rgba(0, 0, 0, 0)" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="10" cy="4" r="2" fill="currentColor"></circle><circle cx="3.5" cy="5.5" r="1.5" fill="currentColor"></circle><circle cx="6" cy="1" r="1" fill="currentColor"></circle></svg>16K stars</button><a class="BPQwEa_hideMobile BPQwEa_loginBtn" data-discover="true" href="https://github.com/login/oauth/authorize?client_id=Iv23liKJqWZxDyNA4Y9G&amp;scope=read%3Auser+user%3Aemail&amp;redirect_uri=https%3A%2F%2Fspacetimedb.com%2Fapi%2Fauth%2Fgithub%2Fcallback&amp;state=01JTSFM2HKQ1NWZFHE4NZNGE5P&amp;allow_signup=true&amp;prompt=select_account">Login</a><button class="BPQwEa_burger" aria-label="Toggle navigation menu"><span></span></button></div></div></header><div class="BPQwEa_modal"><div class="BPQwEa_modalContainer"><nav class="BPQwEa_nav text-menu"><a data-discover="true" class="" href="../../../install.html">Install</a><a data-discover="true" class="" href="../../../pricing.html">Pricing</a><a data-discover="true" class="" href="../../../maincloud.html">Maincloud</a><a data-discover="true" aria-current="page" class="BPQwEa_active" href="../../../docs.html">Docs</a><a data-discover="true" class="" href="../../../blog.html">Blog</a><a data-discover="true" class="" href="../../../community.html">Community</a></nav><div class="BPQwEa_group"><div class="BPQwEa_communitySection"><h4 class="BPQwEa_title text-xs">Community</h4><div class="BPQwEa_socials"><a href="https://github.com/ClockworkLabs/SpacetimeDB" target="_blank" rel="noreferrer"><svg style="min-width:24px" fill="none" width="24" height="24" viewBox="0 0 20 20"><path d="M10.041 0C4.519 0 0 4.519 0 10.041a10.03 10.03 0 0 0 6.862 9.539c.502.084.669-.251.669-.502v-1.674c-2.761.586-3.347-1.339-3.347-1.339-.418-1.171-1.088-1.506-1.088-1.506-1.004-.586 0-.586 0-.586 1.004.084 1.506 1.004 1.506 1.004.92 1.506 2.343 1.088 2.929.837.084-.669.335-1.088.669-1.339-2.259-.251-4.602-1.088-4.602-4.937a4.04 4.04 0 0 1 1.004-2.678c0-.335-.418-1.339.167-2.678 0 0 .837-.251 2.761 1.004.837-.251 1.674-.335 2.51-.335s1.674.084 2.51.335c1.925-1.339 2.761-1.004 2.761-1.004.586 1.423.167 2.427.084 2.678.669.669 1.004 1.59 1.004 2.678 0 3.849-2.343 4.686-4.602 4.937.335.335.669.92.669 1.841v2.761c0 .251.167.586.669.502a10.03 10.03 0 0 0 6.862-9.539C20.083 4.519 15.564 0 10.041 0z"></path></svg></a><a href="https://discord.gg/SpacetimeDB" target="_blank" rel="noreferrer"><svg style="min-width:24px" fill="none" width="24" height="24" viewBox="0 0 20 20"><path d="M16.7 0c.27.001.537.054.786.158s.475.256.666.447.341.418.444.668.155.517.155.787h0V20l-2.15-1.9-1.21-1.117-1.28-1.19.53 1.85H3.3c-.27-.001-.537-.054-.786-.158s-.475-.256-.666-.447-.341-.418-.444-.668-.155-.517-.155-.787h0V2.06c-.001-.27.052-.537.155-.787s.253-.476.444-.668.417-.343.666-.447S3.03.001 3.3 0h0 13.4zm-5.05 4.66l-.14.16c.911.242 1.759.675 2.49 1.27a8.15 8.15 0 0 0-3.013-.963 8.46 8.46 0 0 0-2.02.02c-.056.002-.112.009-.167.02a7.51 7.51 0 0 0-2.27.633l-.59.29a6.75 6.75 0 0 1 2.637-1.31h0l-.1-.12c-1.023.051-2.005.417-2.81 1.05a13.39 13.39 0 0 0-1.44 5.833c.345.484.803.876 1.335 1.141s1.121.395 1.715.379l.667-.833a3.11 3.11 0 0 1-1.75-1.18c.357.239.739.437 1.14.59a8.39 8.39 0 0 0 1.467.43c.855.164 1.734.168 2.59.01a6.58 6.58 0 0 0 1.45-.43 5.72 5.72 0 0 0 1.15-.59c-.444.598-1.085 1.019-1.81 1.19l.07.088.142.177.448.545c.595.015 1.185-.115 1.718-.379s.994-.655 1.342-1.138a13.39 13.39 0 0 0-1.44-5.833c-.805-.633-1.787-.999-2.81-1.05h0zm.056 3.727l.134.003c.14.006.277.039.404.098s.241.142.336.245.168.224.216.355.07.271.064.411c0 .224-.068.444-.194.629s-.306.328-.515.41-.438.098-.656.047-.417-.166-.569-.332-.25-.372-.282-.594.004-.449.102-.65.256-.368.451-.479.419-.159.643-.14l-.134-.003zM8.19 8.39c.14.005.278.038.405.097a1.06 1.06 0 0 1 .553.601 1.06 1.06 0 0 1 .062.412l-.001.105c-.006.104-.027.208-.063.306-.048.131-.122.252-.216.355s-.209.187-.336.245-.264.092-.404.098c-.278-.024-.536-.152-.725-.357s-.293-.474-.293-.753.105-.548.293-.753.447-.333.725-.357z"></path></svg></a><a href="https://twitter.com/spacetime_db" target="_blank" rel="noreferrer"><svg style="min-width:24px" fill="none" width="24" height="24" viewBox="0 0 20 20"><path d="M20 3.833c-.75.333-1.5.583-2.333.667.833-.5 1.5-1.333 1.833-2.25-.833.5-1.667.833-2.583 1-.75-.833-1.833-1.333-3-1.333A4.09 4.09 0 0 0 9.833 6c0 .333 0 .667.083.917-3.5-.167-6.5-1.833-8.5-4.333a3.76 3.76 0 0 0-.583 2.083c0 1.417.75 2.667 1.833 3.417-.667 0-1.333-.167-1.833-.5v.083c0 2 1.417 3.667 3.25 4-.333.083-.667.167-1.083.167-.25 0-.5 0-.75-.083a3.95 3.95 0 0 0 3.833 2.833c-1.417 1.083-3.167 1.75-5.083 1.75-.333 0-.667 0-1-.083 1.833 1.167 4 1.833 6.25 1.833 7.583 0 11.667-6.25 11.667-11.667v-.5c.833-.583 1.5-1.333 2.083-2.083z"></path></svg></a><a href="https://www.twitch.tv/SpacetimeDB" target="_blank" rel="noreferrer"><svg style="min-width:24px" fill="none" width="24" height="24" viewBox="0 0 20 20"><path d="M3.55263 0L0 3.57143V16.4286H4.26316V20L7.81579 16.4286H10.6579L17.0526 10V0H3.55263ZM15.6316 9.28571L12.7895 12.1429H9.94737L7.46053 14.6429V12.1429H4.26316V1.42857H15.6316V9.28571Z M13.5 3.92857H12.0789V8.21429H13.5V3.92857Z M9.59211 3.92857H8.17105V8.21429H9.59211V3.92857Z"></path></svg></a><a href="https://www.youtube.com/@SpacetimeDB" target="_blank" rel="noreferrer"><svg style="min-width:24px" fill="none" width="24" height="24" viewBox="0 0 20 20"><path d="M19.833 6S19.667 4.583 19 4c-.75-.833-1.583-.833-2-.833L10 3l-7 .167C2.583 3.25 1.75 3.25 1 4c-.583.583-.833 2-.833 2S0 7.583 0 9.25v1.5C0 12.333.167 14 .167 14s.167 1.417.833 2c.75.833 1.75.75 2.167.833C4.75 17 10 17 10 17l7-.25c.417-.083 1.25-.083 2-.833.583-.583.833-2 .833-2s.167-1.583.167-3.25v-1.5C20 7.583 19.833 6 19.833 6zM7.917 12.583V7l5.417 2.833-5.417 2.75z"></path></svg></a></div></div><div class="BPQwEa_buttons"><button cy-data="" class="GM6BWG_button GM6BWG_primary BPQwEa_starUsBtn BPQwEa_starUsBtnMobile text-menu" aria-label="16K stars" type="button"><svg class="GM6BWG_leftIcon" style="min-width:20px" fill="none" width="20" height="20" viewBox="0 0 20 20"><path d="M8.12384 7.08774C7.87849 6.97075 7.59345 6.97075 7.3481 7.08774C7.136 7.18886 7.01906 7.36444 6.96009 7.46077C6.89912 7.56035 6.83654 7.6872 6.77554 7.81084L5.48033 10.4348L2.58314 10.8583C2.44676 10.8782 2.30682 10.8986 2.19332 10.9259C2.08351 10.9523 1.88049 11.0094 1.71892 11.1799C1.53201 11.3772 1.44411 11.6483 1.47969 11.9178C1.51044 12.1507 1.64133 12.316 1.71475 12.4018C1.79064 12.4905 1.89197 12.5892 1.99073 12.6854L4.08627 14.7264L3.59181 17.6093C3.56847 17.7452 3.54452 17.8847 3.53531 18.0011C3.52639 18.1137 3.51777 18.3245 3.62995 18.5311C3.7597 18.7699 3.99034 18.9375 4.25762 18.987C4.4887 19.0299 4.68654 18.9565 4.79087 18.9132C4.89875 18.8684 5.02397 18.8026 5.14603 18.7383L7.73597 17.3763L10.3259 18.7383C10.448 18.8026 10.5732 18.8685 10.6811 18.9132C10.7854 18.9565 10.9832 19.0299 11.2143 18.987C11.4816 18.9375 11.7122 18.7699 11.842 18.5311C11.9542 18.3245 11.9455 18.1137 11.9366 18.0011C11.9274 17.8847 11.9035 17.7453 11.8801 17.6093L11.3857 14.7264L13.4812 12.6853C13.58 12.5892 13.6813 12.4905 13.7572 12.4018C13.8306 12.316 13.9615 12.1507 13.9922 11.9178C14.0278 11.6483 13.9399 11.3772 13.753 11.1799C13.5914 11.0094 13.3884 10.9523 13.2786 10.9259C13.1651 10.8986 13.0252 10.8782 12.8888 10.8583L9.99161 10.4348L8.69642 7.81089C8.63542 7.68724 8.57282 7.56036 8.51185 7.46077C8.45288 7.36444 8.33594 7.18886 8.12384 7.08774Z" fill="currentColor" stroke="rgba(0, 0, 0, 0)" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="10" cy="4" r="2" fill="currentColor"></circle><circle cx="3.5" cy="5.5" r="1.5" fill="currentColor"></circle><circle cx="6" cy="1" r="1" fill="currentColor"></circle></svg>16K stars</button></div><div class="BPQwEa_buttons"><a cy-data="" aria-label="try the demo" class="GM6BWG_button GM6BWG_secondary text-menu" type="button" data-discover="true" href="quickstart.html#demo" target=""><svg class="GM6BWG_leftIcon" style="min-width:20px" fill="none" width="20" height="20" viewBox="0 0 20 20"><path d="M10.108 1.55c4.611 0 8.35 3.741 8.35 8.35h0v.208a8.36 8.36 0 0 1-8.35 8.35h0H9.9c-4.611 0-8.35-3.741-8.35-8.35h0V9.9c0-4.611 3.741-8.35 8.35-8.35h0zm0 1.5H9.9c-3.78 0-6.85 3.067-6.85 6.85h0v.208c0 3.78 3.067 6.85 6.85 6.85h0 .208a6.86 6.86 0 0 0 6.85-6.85h0V9.9c0-3.78-3.067-6.85-6.85-6.85h0zm.864 4.29l.084.073 2.048 2.056h0a.75.75 0 0 1 .108.136.74.74 0 0 1 .03.052c.006.012.012.024.017.036.011.024.02.048.028.072a.76.76 0 0 1 .009.031.75.75 0 0 1 .018.08.76.76 0 0 1 .005.034.75.75 0 0 1 .005.069c0 .016 0 .033 0 .049-.001.022-.003.043-.005.065-.002.015-.004.03-.007.045-.005.026-.011.051-.018.077a.73.73 0 0 1-.009.028.75.75 0 0 1-.033.082c-.003.007-.007.014-.01.021-.02.04-.045.078-.073.115l-.062.07-2.05 2.058a.75.75 0 0 1-1.135-.974l.072-.084.775-.779H7.425a.75.75 0 0 1-.102-1.493l.102-.007h3.345l-.776-.779a.75.75 0 0 1 .979-1.131z"></path></svg>try the demo</a><a cy-data="" aria-label="install" class="GM6BWG_button GM6BWG_primary text-menu" type="button" data-discover="true" href="../../../install.html" target=""><svg class="GM6BWG_leftIcon" style="min-width:20px" fill="none" width="20" height="20" viewBox="0 0 20 20"><path d="M15.333 6.25c1.703 0 3.069 1.339 3.162 3.064l.005.186v5.75c0 1.752-1.307 3.151-2.985 3.245l-.181.005H4.583c-1.703 0-3.07-1.339-3.162-3.064l-.005-.186V9.5c0-1.814 1.403-3.25 3.167-3.25a.75.75 0 1 1 0 1.5c-.879 0-1.588.679-1.661 1.595l-.006.155v5.75c0 .941.663 1.67 1.522 1.744l.145.006h10.75c.879 0 1.588-.679 1.661-1.595L17 15.25V9.5c0-.993-.739-1.75-1.667-1.75a.75.75 0 1 1 0-1.5zM9.377 9.854L7.044 7.438a.75.75 0 0 1 .996-1.116l.083.074 1.043 1.081v-5.06a.75.75 0 0 1 1.493-.102l.007.102v5.105l1.136-1.135a.75.75 0 0 1 1.133.977l-.073.084-2.417 2.417h0l-.009.009h0l-.025.023-.045.037-.005.004-.013.007-.007.007-.063.039-.022.012-.037.018-.024.01-.022.008-.023.008-.031.009-.047.011-.027.005-.052.007-.047.003h-.029l-.038-.001-.04-.003-.024-.003h0l-.014-.002-.028-.005-.04-.009-.038-.011-.026-.009-.031-.011-.049-.022-.038-.02a.72.72 0 0 1-.061-.038l-.024-.017c-.028-.021-.054-.044-.079-.069l-.009-.009z"></path></svg>install</a></div><div class="BPQwEa_background"><img src="../../../images/space-time-astrolabe.jpg" alt="Astrolabe" loading="lazy" width="1616" height="2444"/></div></div></div></div><div class="wtWGoa_root" style="padding-top:144px"><div class="_1ZGmjW_root _1ZGmjW_visible FTy4tq_layoutContainer"><nav class="_7MaBSq_sidebar"><a class="_7MaBSq_pageTitle" data-discover="true" href="../../ai-chat.html">Ask AI Chat</a><p class="_7MaBSq_sectionTitle">Intro</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../../docs.html">Overview</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../getting-started.html">Getting Started</a><p class="_7MaBSq_sectionTitle">Deploying</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../deploying/maincloud.html">Maincloud</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../deploying/spacetimedb-standalone.html">Self-Hosting SpacetimeDB</a><p class="_7MaBSq_sectionTitle">Unity Tutorial - Basic Multiplayer</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../unity.html">Overview</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../unity/part-1.html">1 - Setup</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../unity/part-2.html">2 - Connecting to SpacetimeDB</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../unity/part-3.html">3 - Gameplay</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../unity/part-4.html">4 - Moving and Colliding</a><p class="_7MaBSq_sectionTitle">CLI Reference</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../cli-reference.html">CLI Reference</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../cli-reference/standalone-config.html">SpacetimeDB Standalone Configuration</a><p class="_7MaBSq_sectionTitle">Server Module Languages</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../modules.html">Overview</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../modules/rust/quickstart.html">Rust Quickstart</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../modules/rust.html">Rust Reference</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../modules/c-sharp/quickstart.html">C# Quickstart</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../modules/c-sharp.html">C# Reference</a><p class="_7MaBSq_sectionTitle">Client SDK Languages</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../sdks.html">Overview</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../c-sharp/quickstart.html">C# Quickstart</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../c-sharp.html">C# Reference</a><a class="_7MaBSq_pageTitle _7MaBSq_active" data-discover="true" href="quickstart.html">Rust Quickstart</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../rust.html">Rust Reference</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../typescript/quickstart.html">TypeScript Quickstart</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../typescript.html">TypeScript Reference</a><p class="_7MaBSq_sectionTitle">SQL</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../sql.html">SQL Reference</a><p class="_7MaBSq_sectionTitle">Subscriptions</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../subscriptions.html">Subscription Reference</a><p class="_7MaBSq_sectionTitle">Row Level Security</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../rls.html">Row Level Security</a><p class="_7MaBSq_sectionTitle">How To</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../how-to/incremental-migrations.html">Incremental Migrations</a><p class="_7MaBSq_sectionTitle">HTTP API</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../http/authorization.html">Authorization</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../http/identity.html">`/identity`</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../http/database.html">`/database`</a><p class="_7MaBSq_sectionTitle">Internals</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../webassembly-abi.html">Module ABI Reference</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../sats-json.html">SATS-JSON Data Format</a><a class="_7MaBSq_pageTitle" data-discover="true" href="../../bsatn.html">BSATN Data Format</a><p class="_7MaBSq_sectionTitle">Appendix</p><a class="_7MaBSq_pageTitle" data-discover="true" href="../../appendix.html">Appendix</a></nav><div class="WT-eTq_content"><div><article class="sc30Jq_mdc md-body-docs line-break"><h2 id="rust-client-sdk-quick-start">Rust Client SDK Quick Start<a href="#rust-client-sdk-quick-start" class="permalink"><span class="visually-hidden"></span></a></h2><p>In this guide we&#39;ll show you how to get up and running with a simple SpacetimeDB app with a client written in Rust.</p>
<p>We&#39;ll implement a command-line client for the module created in our Rust or C# Module Quickstart guides. Make sure you follow one of these guides before you start on this one.</p>
<h3 id="project-structure">Project structure<a href="#project-structure" class="permalink"><span class="visually-hidden"></span></a></h3><p>Enter the directory <code>quickstart-chat</code> you created in the <a href="../../modules/rust/quickstart.html">Rust Module Quickstart</a> or <a href="../../modules/c-sharp/quickstart.html">C# Module Quickstart</a> guides:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">cd</span><span style="color:#F1FA8C"> quickstart-chat</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>Within it, create a <code>client</code> crate, our client application, which users run locally:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#50FA7B">cargo</span><span style="color:#F1FA8C"> new</span><span style="color:#F1FA8C"> client</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="depend-on-spacetimedb-sdk-and-hex">Depend on `spacetimedb-sdk` and `hex`<a href="#depend-on-spacetimedb-sdk-and-hex" class="permalink"><span class="visually-hidden"></span></a></h3><p><code>client/Cargo.toml</code> should be initialized without any dependencies. We&#39;ll need two:</p>
<ul>
<li><a href="https://crates.io/crates/spacetimedb-sdk"><code>spacetimedb-sdk</code></a>, which defines client-side interfaces for interacting with a remote SpacetimeDB database.</li>
<li><a href="https://crates.io/crates/hex"><code>hex</code></a>, which we&#39;ll use to print unnamed users&#39; identities as hexadecimal strings.</li>
</ul>
<p>Below the <code>[dependencies]</code> line in <code>client/Cargo.toml</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">spacetimedb-sdk</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">1.0</span><span style="color:#E9F284">"</span></span>
<span class="line"><span style="color:#8BE9FD">hex</span><span style="color:#FF79C6"> =</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">0.4</span><span style="color:#E9F284">"</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>Make sure you depend on the same version of <code>spacetimedb-sdk</code> as is reported by the SpacetimeDB CLI tool&#39;s <code>spacetime version</code>!</p>
<h3 id="clear-clientsrcmainrs">Clear `client/src/main.rs`<a href="#clear-clientsrcmainrs" class="permalink"><span class="visually-hidden"></span></a></h3><p><code>client/src/main.rs</code> should be initialized with a trivial &quot;Hello world&quot; program. Clear it out so we can write our chat client.</p>
<p>In your <code>quickstart-chat</code> directory, run:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#50FA7B">rm</span><span style="color:#F1FA8C"> client/src/main.rs</span></span>
<span class="line"><span style="color:#50FA7B">touch</span><span style="color:#F1FA8C"> client/src/main.rs</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="generate-your-module-types">Generate your module types<a href="#generate-your-module-types" class="permalink"><span class="visually-hidden"></span></a></h3><p>The <code>spacetime</code> CLI&#39;s <code>generate</code> command will generate client-side interfaces for the tables, reducers and types referenced by tables or reducers defined in your server module.</p>
<p>In your <code>quickstart-chat</code> directory, run:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#50FA7B">mkdir</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> client/src/module_bindings</span></span>
<span class="line"><span style="color:#50FA7B">spacetime</span><span style="color:#F1FA8C"> generate</span><span style="color:#BD93F9"> --lang</span><span style="color:#F1FA8C"> rust</span><span style="color:#BD93F9"> --out-dir</span><span style="color:#F1FA8C"> client/src/module_bindings</span><span style="color:#BD93F9"> --project-path</span><span style="color:#F1FA8C"> server</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>Take a look inside <code>client/src/module_bindings</code>. The CLI should have generated a few files:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span>module_bindings/</span></span>
<span class="line"><span>├── identity_connected_reducer.rs</span></span>
<span class="line"><span>├── identity_disconnected_reducer.rs</span></span>
<span class="line"><span>├── message_table.rs</span></span>
<span class="line"><span>├── message_type.rs</span></span>
<span class="line"><span>├── mod.rs</span></span>
<span class="line"><span>├── send_message_reducer.rs</span></span>
<span class="line"><span>├── set_name_reducer.rs</span></span>
<span class="line"><span>├── user_table.rs</span></span>
<span class="line"><span>└── user_type.rs</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>To use these, we&#39;ll declare the module in our client crate and import its definitions.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#FF79C6">mod</span><span style="color:#F8F8F2"> module_bindings;</span></span>
<span class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> module_bindings</span><span style="color:#FF79C6">::*</span><span style="color:#F8F8F2">;</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="add-more-imports">Add more imports<a href="#add-more-imports" class="permalink"><span class="visually-hidden"></span></a></h3><p>We&#39;ll need additional imports from <code>spacetimedb_sdk</code> for interacting with the database, handling credentials, and managing events.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> spacetimedb_sdk</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{credentials, </span><span style="color:#8BE9FD;font-style:italic">DbContext</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Error</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Event</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Identity</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Status</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">Table</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">TableWithPrimaryKey</span><span style="color:#F8F8F2">};</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="define-the-main-function">Define the main function<a href="#define-the-main-function" class="permalink"><span class="visually-hidden"></span></a></h3><p>Our <code>main</code> function will do the following:</p>
<ol>
<li>Connect to the database.</li>
<li>Register a number of callbacks to run in response to various database events.</li>
<li>Subscribe to a set of SQL queries, whose results will be replicated and automatically updated in our client.</li>
<li>Spawn a background thread where our connection will process messages and invoke callbacks.</li>
<li>Enter a loop to handle user input from the command line.</li>
</ol>
<p>We&#39;ll see the implementation of these functions a bit later, but for now add to <code>client/src/main.rs</code>:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> main</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#6272A4">    // Connect to the database</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> ctx </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> connect_to_db</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Register callbacks to run in response to database events.</span></span>
<span class="line"><span style="color:#50FA7B">    register_callbacks</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&#x26;</span><span style="color:#F8F8F2">ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Subscribe to SQL queries in order to construct a local partial replica of the database.</span></span>
<span class="line"><span style="color:#50FA7B">    subscribe_to_tables</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&#x26;</span><span style="color:#F8F8F2">ctx);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Spawn a thread, where the connection will process messages and invoke callbacks.</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">run_threaded</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // Handle CLI input</span></span>
<span class="line"><span style="color:#50FA7B">    user_input_loop</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&#x26;</span><span style="color:#F8F8F2">ctx);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="connect-to-the-database">Connect to the database<a href="#connect-to-the-database" class="permalink"><span class="visually-hidden"></span></a></h3><p>A connection to a SpacetimeDB database is represented by a <code>DbConnection</code>. We configure <code>DbConnection</code>s using the builder pattern, by calling <code>DbConnection::builder()</code>, chaining method calls to set various connection parameters and register callbacks, then we cap it off with a call to <code>.build()</code> to begin the connection.</p>
<p>In our case, we&#39;ll supply the following options:</p>
<ol>
<li>An <code>on_connect</code> callback, to run when the remote database acknowledges and accepts our connection.</li>
<li>An <code>on_connect_error</code> callback, to run if the remote database is unreachable or it rejects our connection.</li>
<li>An <code>on_disconnect</code> callback, to run when our connection ends.</li>
<li>A <code>with_token</code> call, to supply a token to authenticate with.</li>
<li>A <code>with_module_name</code> call, to specify the name or <code>Identity</code> of our database. Make sure to pass the same name here as you supplied to <code>spacetime publish</code>.</li>
<li>A <code>with_uri</code> call, to specify the URI of the SpacetimeDB host where our database is running.</li>
</ol>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// The URI of the SpacetimeDB instance hosting our chat database and module.</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> HOST</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">str</span><span style="color:#FF79C6"> =</span><span style="color:#F1FA8C"> "http://localhost:3000"</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">/// The database name we chose when we published our module.</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#BD93F9"> DB_NAME</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">str</span><span style="color:#FF79C6"> =</span><span style="color:#F1FA8C"> "quickstart-chat"</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">/// Load credentials from a file and connect to the database.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> connect_to_db</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-></span><span style="color:#8BE9FD;font-style:italic"> DbConnection</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    DbConnection</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">builder</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#6272A4">        // Register our `on_connect` callback, which will save our auth token.</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">on_connect</span><span style="color:#F8F8F2">(on_connected)</span></span>
<span class="line"><span style="color:#6272A4">        // Register our `on_connect_error` callback, which will print a message, then exit the process.</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">on_connect_error</span><span style="color:#F8F8F2">(on_connect_error)</span></span>
<span class="line"><span style="color:#6272A4">        // Our `on_disconnect` callback, which will print a message, then exit the process.</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">on_disconnect</span><span style="color:#F8F8F2">(on_disconnected)</span></span>
<span class="line"><span style="color:#6272A4">        // If the user has previously connected, we'll have saved a token in the `on_connect` callback.</span></span>
<span class="line"><span style="color:#6272A4">        // In that case, we'll load it and pass it to `with_token`,</span></span>
<span class="line"><span style="color:#6272A4">        // so we can re-authenticate as the same `Identity`.</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">with_token</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">creds_store</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">load</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Error loading credentials"</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#6272A4">        // Set the database name we chose when we called `spacetime publish`.</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">with_module_name</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">DB_NAME</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#6272A4">        // Set the URI of the SpacetimeDB host that's running our database.</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">with_uri</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">HOST</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#6272A4">        // Finalize configuration and connect!</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">build</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Failed to connect"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="save-credentials">Save credentials<a href="#save-credentials" class="permalink"><span class="visually-hidden"></span></a></h4><p>SpacetimeDB will accept any <a href="https://openid.net/developers/how-connect-works/">OpenID Connect</a> compliant <a href="https://jwt.io/">JSON Web Token</a> and use it to compute an <code>Identity</code> for the user. More complex applications will generally authenticate their user somehow, generate or retrieve a token, and attach it to their connection via <code>with_token</code>. In our case, though, we&#39;ll connect anonymously the first time, let SpacetimeDB generate a fresh <code>Identity</code> and corresponding JWT for us, and save that token locally to re-use the next time we connect.</p>
<p>The Rust SDK provides a pair of functions in <code>File</code>, <code>save</code> and <code>load</code>, for saving and storing these credentials in a file. By default the <code>save</code> and <code>load</code> will look for credentials in the <code>$HOME/.spacetimedb_client_credentials/</code> directory, which should be unintrusive. If saving our credentials fails, we&#39;ll print a message to standard error, but otherwise continue; even though the user won&#39;t be able to reconnect with the same identity, they can still chat normally.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> creds_store</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-></span><span style="color:#F8F8F2"> credentials</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">File</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    credentials</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD;font-style:italic">File</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"quickstart-chat"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">/// Our `on_connect` callback: save our credentials to a file.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_connected</span><span style="color:#F8F8F2">(_ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">DbConnection</span><span style="color:#F8F8F2">, _identity</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Identity</span><span style="color:#F8F8F2">, token</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">str</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Err</span><span style="color:#F8F8F2">(e) </span><span style="color:#FF79C6">=</span><span style="color:#50FA7B"> creds_store</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">save</span><span style="color:#F8F8F2">(token) {</span></span>
<span class="line"><span style="color:#50FA7B">        eprintln!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Failed to save credentials: {:?}"</span><span style="color:#F8F8F2">, e);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="handle-errors-and-disconnections">Handle errors and disconnections<a href="#handle-errors-and-disconnections" class="permalink"><span class="visually-hidden"></span></a></h4><p>We need to handle connection errors and disconnections by printing appropriate messages and exiting the program. These callbacks take an <code>ErrorContext</code>, a <code>DbConnection</code> that&#39;s been augmented with information about the error that occured.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Our `on_connect_error` callback: print the error, then exit the process.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_connect_error</span><span style="color:#F8F8F2">(_ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">ErrorContext</span><span style="color:#F8F8F2">, err</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#50FA7B">    eprintln!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Connection error: {:?}"</span><span style="color:#F8F8F2">, err);</span></span>
<span class="line"><span style="color:#F8F8F2">    std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">process</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">exit</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">/// Our `on_disconnect` callback: print a note, then exit the process.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_disconnected</span><span style="color:#F8F8F2">(_ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">ErrorContext</span><span style="color:#F8F8F2">, err</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Option</span><span style="color:#F8F8F2">&#x3C;</span><span style="color:#8BE9FD;font-style:italic">Error</span><span style="color:#F8F8F2">>) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(err) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> err {</span></span>
<span class="line"><span style="color:#50FA7B">        eprintln!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Disconnected: {}"</span><span style="color:#F8F8F2">, err);</span></span>
<span class="line"><span style="color:#F8F8F2">        std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">process</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">exit</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#50FA7B">        println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Disconnected."</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">process</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">exit</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="register-callbacks">Register callbacks<a href="#register-callbacks" class="permalink"><span class="visually-hidden"></span></a></h3><p>We need to handle several sorts of events:</p>
<ol>
<li>When a new user joins, we&#39;ll print a message introducing them.</li>
<li>When a user is updated, we&#39;ll print their new name, or declare their new online status.</li>
<li>When we receive a new message, we&#39;ll print it.</li>
<li>If the server rejects our attempt to set our name, we&#39;ll print an error.</li>
<li>If the server rejects a message we send, we&#39;ll print an error.</li>
</ol>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Register all the callbacks our app will use to respond to database events.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> register_callbacks</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">DbConnection</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#6272A4">    // When a new user joins, print a notification.</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">on_insert</span><span style="color:#F8F8F2">(on_user_inserted);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // When a user's status changes, print a notification.</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">on_update</span><span style="color:#F8F8F2">(on_user_updated);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // When a new message is received, print it.</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">message</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">on_insert</span><span style="color:#F8F8F2">(on_message_inserted);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // When we fail to set our name, print a warning.</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">reducers</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">on_set_name</span><span style="color:#F8F8F2">(on_name_set);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    // When we fail to send a message, print a warning.</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">reducers</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">on_send_message</span><span style="color:#F8F8F2">(on_message_sent);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="notify-about-new-users">Notify about new users<a href="#notify-about-new-users" class="permalink"><span class="visually-hidden"></span></a></h4><p>For each table, we can register on-insert and on-delete callbacks to be run whenever a subscribed row is inserted or deleted. We register these callbacks using the <code>on_insert</code> and <code>on_delete</code>, which is automatically implemented for each table by <code>spacetime generate</code>.</p>
<p>These callbacks can fire in several contexts, of which we care about two:</p>
<ul>
<li>After a reducer runs, when the client&#39;s cache is updated about changes to subscribed rows.</li>
<li>After calling <code>subscribe</code>, when the client&#39;s cache is initialized with all existing matching rows.</li>
</ul>
<p>This second case means that, even though the module only ever inserts online users, the client&#39;s <code>conn.db.user().on_insert(..)</code> callbacks may be invoked with users who are offline. We&#39;ll only notify about online users.</p>
<p><code>on_insert</code> and <code>on_delete</code> callbacks take two arguments: an <code>&amp;EventContext</code> and the modified row. Like the <code>ErrorContext</code> above, <code>EventContext</code> is a <code>DbConnection</code> that&#39;s been augmented with information about the event that caused the row to be modified. You can determine whether the insert/delete operation was caused by a reducer, a newly-applied subscription, or some other event by pattern-matching on <code>ctx.event</code>.</p>
<p>Whenever we want to print a user, if they have set a name, we&#39;ll use that. If they haven&#39;t set a name, we&#39;ll instead print the first 8 bytes of their identity, encoded as hexadecimal. We&#39;ll define functions <code>user_name_or_identity</code> and <code>identity_leading_hex</code> to handle this.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Our `User::on_insert` callback:</span></span>
<span class="line"><span style="color:#6272A4">/// if the user is online, print a notification.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_user_inserted</span><span style="color:#F8F8F2">(_ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#F8F8F2">, user</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> user</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">online {</span></span>
<span class="line"><span style="color:#50FA7B">        println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"User {} connected."</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">user_name_or_identity</span><span style="color:#F8F8F2">(user));</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> user_name_or_identity</span><span style="color:#F8F8F2">(user</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-></span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">    user</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">unwrap_or_else</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">||</span><span style="color:#F8F8F2"> user</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">identity</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_hex</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="notify-about-updated-users">Notify about updated users<a href="#notify-about-updated-users" class="permalink"><span class="visually-hidden"></span></a></h4><p>Because we declared a <code>#[primary_key]</code> column in our <code>User</code> table, we can also register on-update callbacks. These run whenever a row is replaced by a row with the same primary key, like our module&#39;s <code>ctx.db.user().identity().update(..)</code> calls. We register these callbacks using the <code>on_update</code> method of the trait <code>TableWithPrimaryKey</code>, which is automatically implemented by <code>spacetime generate</code> for any table with a <code>#[primary_key]</code> column.</p>
<p><code>on_update</code> callbacks take three arguments: the <code>&amp;EventContext</code>, the old row, and the new row.</p>
<p>In our module, users can be updated for three reasons:</p>
<ol>
<li>They&#39;ve set their name using the <code>set_name</code> reducer.</li>
<li>They&#39;re an existing user re-connecting, so their <code>online</code> has been set to <code>true</code>.</li>
<li>They&#39;ve disconnected, so their <code>online</code> has been set to <code>false</code>.</li>
</ol>
<p>We&#39;ll print an appropriate message in each of these cases.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Our `User::on_update` callback:</span></span>
<span class="line"><span style="color:#6272A4">/// print a notification about name and status changes.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_user_updated</span><span style="color:#F8F8F2">(_ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#F8F8F2">, old</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2">, new</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">User</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> old</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name </span><span style="color:#FF79C6">!=</span><span style="color:#F8F8F2"> new</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name {</span></span>
<span class="line"><span style="color:#50FA7B">        println!</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#F1FA8C">            "User {} renamed to {}."</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#50FA7B">            user_name_or_identity</span><span style="color:#F8F8F2">(old),</span></span>
<span class="line"><span style="color:#50FA7B">            user_name_or_identity</span><span style="color:#F8F8F2">(new)</span></span>
<span class="line"><span style="color:#F8F8F2">        );</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#F8F8F2"> old</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">online </span><span style="color:#FF79C6">&#x26;&#x26;</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">new</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">online {</span></span>
<span class="line"><span style="color:#50FA7B">        println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"User {} disconnected."</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">user_name_or_identity</span><span style="color:#F8F8F2">(new));</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> !</span><span style="color:#F8F8F2">old</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">online </span><span style="color:#FF79C6">&#x26;&#x26;</span><span style="color:#F8F8F2"> new</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">online {</span></span>
<span class="line"><span style="color:#50FA7B">        println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"User {} connected."</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">user_name_or_identity</span><span style="color:#F8F8F2">(new));</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="print-messages">Print messages<a href="#print-messages" class="permalink"><span class="visually-hidden"></span></a></h4><p>When we receive a new message, we&#39;ll print it to standard output, along with the name of the user who sent it. Keep in mind that we only want to do this for new messages, i.e. those inserted by a <code>send_message</code> reducer invocation. We have to handle the backlog we receive when our subscription is initialized separately, to ensure they&#39;re printed in the correct order. To that effect, our <code>on_message_inserted</code> callback will check if the ctx.event type is an <code>Event::Reducer</code>, and only print in that case.</p>
<p>To find the <code>User</code> based on the message&#39;s <code>sender</code> identity, we&#39;ll use <code>ctx.db.user().identity().find(..)</code>, which behaves like the same function on the server.</p>
<p>We&#39;ll print the user&#39;s name or identity in the same way as we did when notifying about <code>User</code> table events, but here we have to handle the case where we don&#39;t find a matching <code>User</code> row. This can happen when the module owner sends a message using the CLI&#39;s <code>spacetime call</code>. In this case, we&#39;ll print <code>unknown</code>.</p>
<p>Notice that our <code>print_message</code> function takes an <code>&amp;impl RemoteDbContext</code> as an argument. This is a trait, defined in our <code>module_bindings</code> by <code>spacetime generate</code>, which is implemented by <code>DbConnection</code>, <code>EventContext</code>, <code>ErrorContext</code> and a few other similar types. (<code>RemoteDbContext</code> is actually a shorthand for <code>DbContext</code>, which applies to connections to <em>any</em> module, with its associated types locked to module-specific ones.) Later on, we&#39;re going to call <code>print_message</code> with a <code>ReducerEventContext</code>, so we need to be more generic than just accepting <code>EventContext</code>.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Our `Message::on_insert` callback: print new messages.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_message_inserted</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">EventContext</span><span style="color:#F8F8F2">, message</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">Message</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Event</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Reducer</span><span style="color:#F8F8F2">(_) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">event {</span></span>
<span class="line"><span style="color:#50FA7B">        print_message</span><span style="color:#F8F8F2">(ctx, message)</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> print_message</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;impl</span><span style="color:#8BE9FD;font-style:italic"> RemoteDbContext</span><span style="color:#F8F8F2">, message</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">Message</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#F8F8F2"> sender </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">db</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">identity</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&#x26;</span><span style="color:#F8F8F2">message</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sender</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">())</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">u</span><span style="color:#FF79C6">|</span><span style="color:#50FA7B"> user_name_or_identity</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&#x26;</span><span style="color:#F8F8F2">u))</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">unwrap_or_else</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">||</span><span style="color:#F1FA8C"> "unknown"</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">());</span></span>
<span class="line"><span style="color:#50FA7B">    println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"{}: {}"</span><span style="color:#F8F8F2">, sender, message</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">text);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="handle-reducer-failures">Handle reducer failures<a href="#handle-reducer-failures" class="permalink"><span class="visually-hidden"></span></a></h4><p>We can also register callbacks to run each time a reducer is invoked. We register these callbacks using the <code>on_reducer</code> method of the <code>Reducer</code> trait, which is automatically implemented for each reducer by <code>spacetime generate</code>.</p>
<p>Each reducer callback first takes a <code>&amp;ReducerEventContext</code> which contains metadata about the reducer call, including the identity of the caller and whether or not the reducer call suceeded.</p>
<p>These callbacks will be invoked in one of two cases:</p>
<ol>
<li>If the reducer was successful and altered any of our subscribed rows.</li>
<li>If we requested an invocation which failed.</li>
</ol>
<p>Note that a status of <code>Failed</code> or <code>OutOfEnergy</code> implies that the caller identity is our own identity.</p>
<p>We already handle successful <code>set_name</code> invocations using our <code>ctx.db.user().on_update(..)</code> callback, but if the module rejects a user&#39;s chosen name, we&#39;d like that user&#39;s client to let them know. We define a function <code>on_set_name</code> as a <code>conn.reducers.on_set_name(..)</code> callback which checks if the reducer failed, and if it did, prints a message including the rejected name and the error.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Our `on_set_name` callback: print a warning if the reducer failed.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_name_set</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">ReducerEventContext</span><span style="color:#F8F8F2">, name</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Status</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Failed</span><span style="color:#F8F8F2">(err) </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">event</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">status {</span></span>
<span class="line"><span style="color:#50FA7B">        eprintln!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Failed to change name to {:?}: {}"</span><span style="color:#F8F8F2">, name, err);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">/// Our `on_send_message` callback: print a warning if the reducer failed.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_message_sent</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">ReducerEventContext</span><span style="color:#F8F8F2">, text</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Status</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Failed</span><span style="color:#F8F8F2">(err) </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#F8F8F2">ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">event</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">status {</span></span>
<span class="line"><span style="color:#50FA7B">        eprintln!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Failed to send message {:?}: {}"</span><span style="color:#F8F8F2">, text, err);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="subscribe-to-queries">Subscribe to queries<a href="#subscribe-to-queries" class="permalink"><span class="visually-hidden"></span></a></h3><p>SpacetimeDB is set up so that each client subscribes via SQL queries to some subset of the database, and is notified about changes only to that subset. For complex apps with large databases, judicious subscriptions can save each client significant network bandwidth, memory and computation. For example, in <a href="https://bitcraftonline.com/">BitCraft</a>, each player&#39;s client subscribes only to the entities in the &quot;chunk&quot; of the world where that player currently resides, rather than the entire game world. Our app is much simpler than BitCraft, so we&#39;ll just subscribe to the whole database.</p>
<p>When we specify our subscriptions, we can supply an <code>on_applied</code> callback. This will run when the subscription is applied and the matching rows become available in our client cache. We&#39;ll use this opportunity to print the message backlog in proper order.</p>
<p>We&#39;ll also provide an <code>on_error</code> callback. This will run if the subscription fails, usually due to an invalid or malformed SQL queries. We can&#39;t handle this case, so we&#39;ll just print out the error and exit the process.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Register subscriptions for all rows of both tables.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> subscribe_to_tables</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">DbConnection</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">    ctx</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">subscription_builder</span><span style="color:#F8F8F2">()</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">on_applied</span><span style="color:#F8F8F2">(on_sub_applied)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">on_error</span><span style="color:#F8F8F2">(on_sub_error)</span></span>
<span class="line"><span style="color:#FF79C6">        .</span><span style="color:#50FA7B">subscribe</span><span style="color:#F8F8F2">([</span><span style="color:#F1FA8C">"SELECT * FROM user"</span><span style="color:#F8F8F2">, </span><span style="color:#F1FA8C">"SELECT * FROM message"</span><span style="color:#F8F8F2">]);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="print-past-messages-in-order">Print past messages in order<a href="#print-past-messages-in-order" class="permalink"><span class="visually-hidden"></span></a></h4><p>Messages we receive live will come in order, but when we connect, we&#39;ll receive all the past messages at once. We can&#39;t just print these in the order we receive them; the logs would be all shuffled around, and would make no sense. Instead, when we receive the log of past messages, we&#39;ll sort them by their sent timestamps and print them in order.</p>
<p>We&#39;ll handle this in our function <code>print_messages_in_order</code>, which we registered as an <code>on_applied</code> callback. <code>print_messages_in_order</code> iterates over all the <code>Message</code>s we&#39;ve received, sorts them, and then prints them. <code>ctx.db.message().iter()</code> is defined on the trait <code>Table</code>, and returns an iterator over all the messages in the client cache. Rust iterators can&#39;t be sorted in-place, so we&#39;ll collect it to a <code>Vec</code>, then use the <code>sort_by_key</code> method to sort by timestamp.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Our `on_subscription_applied` callback:</span></span>
<span class="line"><span style="color:#6272A4">/// sort all past messages and print them in timestamp order.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_sub_applied</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">SubscriptionEventContext</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    let</span><span style="color:#FF79C6"> mut</span><span style="color:#F8F8F2"> messages </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">db</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">message</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">&#x3C;</span><span style="color:#8BE9FD;font-style:italic">Vec</span><span style="color:#F8F8F2">&#x3C;_>>();</span></span>
<span class="line"><span style="color:#F8F8F2">    messages</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">sort_by_key</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">m</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> m</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">sent);</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> message </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> messages {</span></span>
<span class="line"><span style="color:#50FA7B">        print_message</span><span style="color:#F8F8F2">(ctx, </span><span style="color:#FF79C6">&#x26;</span><span style="color:#F8F8F2">message);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#50FA7B">    println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Fully connected and all subscriptions applied."</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#50FA7B">    println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Use /name to set your name, or type a message!"</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h4 id="notify-about-failed-subscriptions">Notify about failed subscriptions<a href="#notify-about-failed-subscriptions" class="permalink"><span class="visually-hidden"></span></a></h4><p>It&#39;s possible for SpacetimeDB to reject subscriptions. This happens most often because of a typo in the SQL queries, but can be due to use of SQL features that SpacetimeDB doesn&#39;t support. See <a href="../../sql.html#subscriptions">SQL Support: Subscriptions</a> for more information about what subscription queries SpacetimeDB supports.</p>
<p>In our case, we&#39;re pretty confident that our queries are valid, but if SpacetimeDB rejects them, we want to know about it. Our callback will print the error, then exit the process.</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Or `on_error` callback:</span></span>
<span class="line"><span style="color:#6272A4">/// print the error, then exit the process.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> on_sub_error</span><span style="color:#F8F8F2">(_ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">ErrorContext</span><span style="color:#F8F8F2">, err</span><span style="color:#FF79C6">:</span><span style="color:#8BE9FD;font-style:italic"> Error</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#50FA7B">    eprintln!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Subscription failed: {}"</span><span style="color:#F8F8F2">, err);</span></span>
<span class="line"><span style="color:#F8F8F2">    std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">process</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">exit</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="handle-user-input">Handle user input<a href="#handle-user-input" class="permalink"><span class="visually-hidden"></span></a></h3><p>Our app should allow the user to interact by typing lines into their terminal. If the line starts with <code>/name </code>, we&#39;ll change the user&#39;s name. Any other line will send a message.</p>
<p>For each reducer defined by our module, <code>ctx.reducers</code> has a method to request an invocation. In our case, we pass <code>set_name</code> and <code>send_message</code> a <code>String</code>, which gets sent to the server to execute the corresponding reducer.</p>
<p>To <code>client/src/main.rs</code>, add:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#6272A4">/// Read each line of standard input, and either set our name or send a message as appropriate.</span></span>
<span class="line"><span style="color:#FF79C6">fn</span><span style="color:#50FA7B"> user_input_loop</span><span style="color:#F8F8F2">(ctx</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> &#x26;</span><span style="color:#8BE9FD;font-style:italic">DbConnection</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    for</span><span style="color:#F8F8F2"> line </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">io</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">stdin</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">lines</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#FF79C6">        let</span><span style="color:#8BE9FD;font-style:italic"> Ok</span><span style="color:#F8F8F2">(line) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> line </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#50FA7B">            panic!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"Failed to read from stdin."</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">        };</span></span>
<span class="line"><span style="color:#FF79C6">        if</span><span style="color:#FF79C6"> let</span><span style="color:#8BE9FD;font-style:italic"> Some</span><span style="color:#F8F8F2">(name) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> line</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">strip_prefix</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">"/name "</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">            ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">reducers</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">set_name</span><span style="color:#F8F8F2">(name</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">        } </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F8F8F2">            ctx</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">reducers</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">send_message</span><span style="color:#F8F8F2">(line)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="run-it">Run it<a href="#run-it" class="permalink"><span class="visually-hidden"></span></a></h3><p>After setting everything up, change your directory to the client app, then compile and run it. From the <code>quickstart-chat</code> directory, run:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#8BE9FD">cd</span><span style="color:#F1FA8C"> client</span></span>
<span class="line"><span style="color:#50FA7B">cargo</span><span style="color:#F1FA8C"> run</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>You should see something like:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span>User d9e25c51996dea2f connected.</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>Now try sending a message by typing <code>Hello, world!</code> and pressing enter. You should see:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span>d9e25c51996dea2f: Hello, world!</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>Next, set your name by typing <code>/name &lt;my-name&gt;</code>, replacing <code>&lt;my-name&gt;</code> with your desired username. You should see:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span>User d9e25c51996dea2f renamed to &#x3C;my-name>.</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>Then, send another message:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span>&#x3C;my-name>: Hello after naming myself.</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><p>Now, close the app by hitting <code>Ctrl+C</code>, and start it again with <code>cargo run</code>. You&#39;ll see yourself connecting, and your past messages will load in order:</p>

<pre class="shiki spacetime-dark" style="background-color:var(--color-bg);color:#F8F8F2" tabindex="0"><code><span class="line"><span>User &#x3C;my-name> connected.</span></span>
<span class="line"><span>&#x3C;my-name>: Hello, world!</span></span>
<span class="line"><span>&#x3C;my-name>: Hello after naming myself.</span></span></code> <button data-copy-code>
    <svg
        class="md-copy-icon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
    >
        <g fill="white">
            <path d="M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z" />
            <path d="M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z" />
        </g>
    </svg>
</button></pre><h3 id="whats-next">What's next?<a href="#whats-next" class="permalink"><span class="visually-hidden"></span></a></h3><p>You can find the full code for this client <a href="https://github.com/clockworklabs/SpacetimeDB/tree/master/crates/sdk/examples/quickstart-chat">in the Rust client SDK&#39;s examples</a>.</p>
<p>Check out the <a href="../rust.html">Rust client SDK Reference</a> for a more comprehensive view of the SpacetimeDB Rust client SDK.</p>
<p>Our basic terminal interface has some limitations. Incoming messages can appear while the user is typing, which is less than ideal. Additionally, the user&#39;s input gets mixed with the program&#39;s output, making messages the user sends appear twice. You might want to try improving the interface by using <a href="https://crates.io/crates/rustyline">Rustyline</a>, <a href="https://crates.io/crates/cursive">Cursive</a>, or even creating a full-fledged GUI.</p>
<p>Once your chat server runs for a while, you might want to limit the messages your client loads by refining your <code>Message</code> subscription query, only subscribing to messages sent within the last half-hour.</p>
<p>You could also add features like:</p>
<ul>
<li>Styling messages by interpreting HTML tags and printing appropriate <a href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI escapes</a>.</li>
<li>Adding a <code>moderator</code> flag to the <code>User</code> table, allowing moderators to manage users (e.g., time-out, ban).</li>
<li>Adding rooms or channels that users can join or leave.</li>
<li>Supporting direct messages or displaying user statuses next to their usernames.</li>
</ul>
</article></div><div class="WT-eTq_bottomDocContent"><div class="WT-eTq_actions"><a class="WT-eTq_prev" data-discover="true" href="../c-sharp.html"><p class="WT-eTq_sub">Previous</p><p class="WT-eTq_title">C# Reference</p></a><a class="WT-eTq_next" data-discover="true" href="../rust.html"><p class="WT-eTq_sub">Next</p><p class="WT-eTq_title">Rust Reference</p></a></div></div><a class="WT-eTq_githubEditStyled" rel="noreferrer" href="https://github.com/clockworklabs/spacetime-docs/edit/master/docs/sdks/rust/quickstart.md" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="white" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"></path></svg>Edit On Github</a></div></div></div><!--$--><!--/$--></div></div><script>((STORAGE_KEY, restoreKey) => {
    if (!window.history.state || !window.history.state.key) {
      let key = Math.random().toString(32).slice(2);
      window.history.replaceState({
        key
      }, "");
    }
    try {
      let positions = JSON.parse(sessionStorage.getItem(STORAGE_KEY) || "{}");
      let storedY = positions[restoreKey || window.history.state.key];
      if (typeof storedY === "number") {
        window.scrollTo(0, storedY);
      }
    } catch (error) {
      console.error(error);
      sessionStorage.removeItem(STORAGE_KEY);
    }
  })("positions", null)</script><link rel="modulepreload" href="../../../assets/entry.client-BGtfi_QV.js"/><link rel="modulepreload" href="../../../assets/jsx-runtime-B8m6gtXl.js"/><link rel="modulepreload" href="../../../assets/index-Gwz8MVWd.js"/><link rel="modulepreload" href="../../../assets/index-DQRDp3BA.js"/><link rel="modulepreload" href="../../../assets/components-DZQBhqap.js"/><link rel="modulepreload" href="../../../assets/index-BtvcE26l.js"/><link rel="modulepreload" href="../../../assets/Layout-BdLUilQM.js"/><link rel="modulepreload" href="../../../assets/preload-helper-D21cck6N.js"/><link rel="modulepreload" href="../../../assets/client-only-wNC5TimA.js"/><link rel="modulepreload" href="../../../assets/Container-DsvKPwib.js"/><link rel="modulepreload" href="../../../assets/clsx-BeLtu-UY.js"/><link rel="modulepreload" href="../../../assets/Icon-mnw7YCvf.js"/><link rel="modulepreload" href="../../../assets/socials-pIkfUSDw.js"/><link rel="modulepreload" href="../../../assets/index-ZcNkxdux.js"/><link rel="modulepreload" href="../../../assets/Button-BsQzyESB.js"/><link rel="modulepreload" href="../../../assets/root-B5VLWL4p.js"/><link rel="modulepreload" href="../../../assets/route-BN3e8Fjz.js"/><link rel="modulepreload" href="../../../assets/ScrollAnimation-CzbpuesT.js"/><link rel="modulepreload" href="../../../assets/route-DJZPQN6P.js"/><link rel="modulepreload" href="../../../assets/route-Xb11ex6F.js"/><link rel="modulepreload" href="../../../assets/MDComponent-S1Ei_Xtk.js"/><link rel="modulepreload" href="../../../assets/route-BsjcODbm.js"/><script>window.__remixContext = {"basename":"/","future":{"v3_fetcherPersist":true,"v3_relativeSplatPath":true,"v3_throwAbortReason":true,"v3_routeConfig":true,"v3_singleFetch":true,"v3_lazyRouteDiscovery":true,"unstable_optimizeDeps":true},"isSpaMode":false};window.__remixContext.stream = new ReadableStream({start(controller){window.__remixContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());</script><script type="module" async="">;
import * as route0 from "/assets/root-B5VLWL4p.js";
import * as route1 from "/assets/route-BN3e8Fjz.js";
import * as route2 from "/assets/route-DJZPQN6P.js";
import * as route3 from "/assets/route-BsjcODbm.js";
window.__remixManifest = {
  "entry": {
    "module": "/assets/entry.client-BGtfi_QV.js",
    "imports": [
      "/assets/jsx-runtime-B8m6gtXl.js",
      "../../../assets/index-Gwz8MVWd.js",
      "../../../assets/index-DQRDp3BA.js",
      "../../../assets/components-DZQBhqap.js"
    ],
    "css": []
  },
  "routes": {
    "root": {
      "id": "root",
      "path": "",
      "hasAction": false,
      "hasLoader": true,
      "hasClientAction": false,
      "hasClientLoader": false,
      "hasErrorBoundary": true,
      "module": "/assets/root-B5VLWL4p.js",
      "imports": [
        "/assets/jsx-runtime-B8m6gtXl.js",
        "../../../assets/index-Gwz8MVWd.js",
        "../../../assets/index-DQRDp3BA.js",
        "../../../assets/components-DZQBhqap.js",
        "../../../assets/index-BtvcE26l.js",
        "../../../assets/Layout-BdLUilQM.js",
        "../../../assets/preload-helper-D21cck6N.js",
        "../../../assets/client-only-wNC5TimA.js",
        "../../../assets/Container-DsvKPwib.js",
        "../../../assets/clsx-BeLtu-UY.js",
        "../../../assets/Icon-mnw7YCvf.js",
        "../../../assets/socials-pIkfUSDw.js",
        "../../../assets/index-ZcNkxdux.js",
        "../../../assets/Button-BsQzyESB.js"
      ],
      "css": [
        "/assets/root-DgiNzMOf.css",
        "../../../assets/Layout-CTL7f1Hd.css",
        "../../../assets/Container-_6nMI5g_.css",
        "../../../assets/Button-C8_kLgtz.css"
      ]
    },
    "routes/_marketing": {
      "id": "routes/_marketing",
      "parentId": "root",
      "hasAction": false,
      "hasLoader": false,
      "hasClientAction": false,
      "hasClientLoader": false,
      "hasErrorBoundary": false,
      "module": "/assets/route-BN3e8Fjz.js",
      "imports": [
        "/assets/jsx-runtime-B8m6gtXl.js",
        "../../../assets/Layout-BdLUilQM.js",
        "../../../assets/components-DZQBhqap.js",
        "../../../assets/index-DQRDp3BA.js",
        "../../../assets/preload-helper-D21cck6N.js",
        "../../../assets/client-only-wNC5TimA.js",
        "../../../assets/Container-DsvKPwib.js",
        "../../../assets/clsx-BeLtu-UY.js",
        "../../../assets/Icon-mnw7YCvf.js",
        "../../../assets/socials-pIkfUSDw.js",
        "../../../assets/index-ZcNkxdux.js",
        "../../../assets/Button-BsQzyESB.js",
        "../../../assets/index-Gwz8MVWd.js"
      ],
      "css": [
        "/assets/Layout-CTL7f1Hd.css",
        "../../../assets/Container-_6nMI5g_.css",
        "../../../assets/Button-C8_kLgtz.css"
      ]
    },
    "routes/_marketing.docs": {
      "id": "routes/_marketing.docs",
      "parentId": "routes/_marketing",
      "path": "docs",
      "hasAction": false,
      "hasLoader": true,
      "hasClientAction": false,
      "hasClientLoader": false,
      "hasErrorBoundary": false,
      "module": "/assets/route-DJZPQN6P.js",
      "imports": [
        "/assets/jsx-runtime-B8m6gtXl.js",
        "../../../assets/ScrollAnimation-CzbpuesT.js",
        "../../../assets/clsx-BeLtu-UY.js",
        "../../../assets/index-DQRDp3BA.js",
        "../../../assets/components-DZQBhqap.js",
        "../../../assets/index-ZcNkxdux.js",
        "../../../assets/index-Gwz8MVWd.js"
      ],
      "css": [
        "/assets/route-DfbkRanz.css",
        "../../../assets/ScrollAnimation-HNI5Nioi.css"
      ]
    },
    "routes/_marketing.docs.$": {
      "id": "routes/_marketing.docs.$",
      "parentId": "routes/_marketing.docs",
      "path": "*",
      "hasAction": false,
      "hasLoader": true,
      "hasClientAction": false,
      "hasClientLoader": false,
      "hasErrorBoundary": false,
      "module": "/assets/route-BsjcODbm.js",
      "imports": [
        "/assets/route-Xb11ex6F.js",
        "../../../assets/jsx-runtime-B8m6gtXl.js",
        "../../../assets/MDComponent-S1Ei_Xtk.js",
        "../../../assets/clsx-BeLtu-UY.js",
        "../../../assets/index-BtvcE26l.js",
        "../../../assets/index-DQRDp3BA.js",
        "../../../assets/components-DZQBhqap.js",
        "../../../assets/index-Gwz8MVWd.js"
      ],
      "css": [
        "/assets/route-DPGvI9WQ.css",
        "../../../assets/MDComponent-CdQtYgZs.css"
      ]
    },
    "routes/_marketing._index": {
      "id": "routes/_marketing._index",
      "parentId": "routes/_marketing",
      "index": true,
      "hasAction": false,
      "hasLoader": true,
      "hasClientAction": false,
      "hasClientLoader": false,
      "hasErrorBoundary": false,
      "module": "/assets/route-D1GAktaa.js",
      "imports": [
        "/assets/route-BjgmKHBp.js",
        "../../../assets/jsx-runtime-B8m6gtXl.js",
        "../../../assets/clsx-BeLtu-UY.js",
        "../../../assets/ScrollAnimation-CzbpuesT.js",
        "../../../assets/index-ZcNkxdux.js",
        "../../../assets/Section-YFQuzqA2.js",
        "../../../assets/Button-BsQzyESB.js",
        "../../../assets/Icon-mnw7YCvf.js",
        "../../../assets/components-DZQBhqap.js",
        "../../../assets/index-Gwz8MVWd.js",
        "../../../assets/index-DQRDp3BA.js",
        "../../../assets/Modal-Drq6A6PB.js",
        "../../../assets/preload-helper-D21cck6N.js",
        "../../../assets/IllustrationSection-CYB1aQb8.js",
        "../../../assets/Hero-CQn9OGBR.js"
      ],
      "css": [
        "/assets/route-BD-0frUD.css",
        "../../../assets/ScrollAnimation-HNI5Nioi.css",
        "../../../assets/Section-BU2yo9B_.css",
        "../../../assets/Button-C8_kLgtz.css",
        "../../../assets/Modal-4Y8efbdF.css",
        "../../../assets/IllustrationSection-Ce9CQF80.css",
        "../../../assets/Hero-BQ6ieBxK.css"
      ]
    },
    "routes/_marketing.docs._index": {
      "id": "routes/_marketing.docs._index",
      "parentId": "routes/_marketing.docs",
      "index": true,
      "hasAction": false,
      "hasLoader": true,
      "hasClientAction": false,
      "hasClientLoader": false,
      "hasErrorBoundary": false,
      "module": "/assets/route-Xb11ex6F.js",
      "imports": [
        "/assets/jsx-runtime-B8m6gtXl.js",
        "../../../assets/MDComponent-S1Ei_Xtk.js",
        "../../../assets/components-DZQBhqap.js",
        "../../../assets/clsx-BeLtu-UY.js",
        "../../../assets/index-BtvcE26l.js",
        "../../../assets/index-DQRDp3BA.js",
        "../../../assets/index-Gwz8MVWd.js"
      ],
      "css": [
        "/assets/route-DPGvI9WQ.css",
        "../../../assets/MDComponent-CdQtYgZs.css"
      ]
    }
  },
  "url": "/assets/manifest-81d72d9d.js",
  "version": "81d72d9d"
};
window.__remixRouteModules = {"root":route0,"routes/_marketing":route1,"routes/_marketing.docs":route2,"routes/_marketing.docs.$":route3};

import("../../../assets/entry.client-BGtfi_QV.js");</script><script class="cookieconsent-optin-statistics" data-cookieconsent="statistics">
                        window.dataLayer = window.dataLayer || [];
                        function gtag(){ dataLayer.push(arguments); }
                        gtag('js', new Date());
                        gtag('config', 'G-PP0E4VHQKG');
                        </script><script src="../../../../uptime.betterstack.com/widgets/announcement.js" data-id="167677" defer="" type="text/javascript"></script></body>
<!-- Mirrored from spacetimedb.com/docs/sdks/rust/quickstart by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 May 2025 02:58:44 GMT -->
</html><!--$--><script>window.__remixContext.streamController.enqueue("[{\"_1\":2,\"_187\":-5,\"_188\":-5},\"loaderData\",{\"_3\":4,\"_10\":11,\"_176\":177,\"_186\":-5},\"root\",{\"_5\":6,\"_7\":8,\"_9\":-7},\"stargazersCount\",15876,\"isAnnouncementVisible\",true,\"sessionUserInfo\",\"routes/_marketing.docs\",{\"_12\":13,\"_174\":175},\"nav\",{\"_14\":15},\"items\",[16,21,28,32,34,38,42,44,47,51,55,59,63,65,68,72,74,77,81,85,89,93,95,98,101,104,107,110,114,118,120,124,126,130,132,135,137,141,143,147,151,155,157,161,165,169,171],{\"_17\":18,\"_19\":20},\"type\",\"section\",\"title\",\"Intro\",{\"_17\":22,\"_23\":24,\"_25\":26,\"_19\":27},\"page\",\"path\",\"index.md\",\"slug\",\"index\",\"Overview\",{\"_17\":22,\"_23\":29,\"_25\":30,\"_19\":31},\"getting-started.md\",\"getting-started\",\"Getting Started\",{\"_17\":18,\"_19\":33},\"Deploying\",{\"_17\":22,\"_23\":35,\"_25\":36,\"_19\":37},\"deploying/maincloud.md\",\"deploying/maincloud\",\"Maincloud\",{\"_17\":22,\"_23\":39,\"_25\":40,\"_19\":41},\"deploying/spacetimedb-standalone.md\",\"deploying/spacetimedb-standalone\",\"Self-Hosting SpacetimeDB\",{\"_17\":18,\"_19\":43},\"Unity Tutorial - Basic Multiplayer\",{\"_17\":22,\"_23\":45,\"_25\":46,\"_19\":27},\"unity/index.md\",\"unity\",{\"_17\":22,\"_23\":48,\"_25\":49,\"_19\":50},\"unity/part-1.md\",\"unity/part-1\",\"1 - Setup\",{\"_17\":22,\"_23\":52,\"_25\":53,\"_19\":54},\"unity/part-2.md\",\"unity/part-2\",\"2 - Connecting to SpacetimeDB\",{\"_17\":22,\"_23\":56,\"_25\":57,\"_19\":58},\"unity/part-3.md\",\"unity/part-3\",\"3 - Gameplay\",{\"_17\":22,\"_23\":60,\"_25\":61,\"_19\":62},\"unity/part-4.md\",\"unity/part-4\",\"4 - Moving and Colliding\",{\"_17\":18,\"_19\":64},\"CLI Reference\",{\"_17\":22,\"_23\":66,\"_25\":67,\"_19\":64},\"cli-reference.md\",\"cli-reference\",{\"_17\":22,\"_23\":69,\"_25\":70,\"_19\":71},\"cli-reference/standalone-config.md\",\"cli-reference/standalone-config\",\"SpacetimeDB Standalone Configuration\",{\"_17\":18,\"_19\":73},\"Server Module Languages\",{\"_17\":22,\"_23\":75,\"_25\":76,\"_19\":27},\"modules/index.md\",\"modules\",{\"_17\":22,\"_23\":78,\"_25\":79,\"_19\":80},\"modules/rust/quickstart.md\",\"modules/rust/quickstart\",\"Rust Quickstart\",{\"_17\":22,\"_23\":82,\"_25\":83,\"_19\":84},\"modules/rust/index.md\",\"modules/rust\",\"Rust Reference\",{\"_17\":22,\"_23\":86,\"_25\":87,\"_19\":88},\"modules/c-sharp/quickstart.md\",\"modules/c-sharp/quickstart\",\"C# Quickstart\",{\"_17\":22,\"_23\":90,\"_25\":91,\"_19\":92},\"modules/c-sharp/index.md\",\"modules/c-sharp\",\"C# Reference\",{\"_17\":18,\"_19\":94},\"Client SDK Languages\",{\"_17\":22,\"_23\":96,\"_25\":97,\"_19\":27},\"sdks/index.md\",\"sdks\",{\"_17\":22,\"_23\":99,\"_25\":100,\"_19\":88},\"sdks/c-sharp/quickstart.md\",\"sdks/c-sharp/quickstart\",{\"_17\":22,\"_23\":102,\"_25\":103,\"_19\":92},\"sdks/c-sharp/index.md\",\"sdks/c-sharp\",{\"_17\":22,\"_23\":105,\"_25\":106,\"_19\":80},\"sdks/rust/quickstart.md\",\"sdks/rust/quickstart\",{\"_17\":22,\"_23\":108,\"_25\":109,\"_19\":84},\"sdks/rust/index.md\",\"sdks/rust\",{\"_17\":22,\"_23\":111,\"_25\":112,\"_19\":113},\"sdks/typescript/quickstart.md\",\"sdks/typescript/quickstart\",\"TypeScript Quickstart\",{\"_17\":22,\"_23\":115,\"_25\":116,\"_19\":117},\"sdks/typescript/index.md\",\"sdks/typescript\",\"TypeScript Reference\",{\"_17\":18,\"_19\":119},\"SQL\",{\"_17\":22,\"_23\":121,\"_25\":122,\"_19\":123},\"sql/index.md\",\"sql\",\"SQL Reference\",{\"_17\":18,\"_19\":125},\"Subscriptions\",{\"_17\":22,\"_23\":127,\"_25\":128,\"_19\":129},\"subscriptions/index.md\",\"subscriptions\",\"Subscription Reference\",{\"_17\":18,\"_19\":131},\"Row Level Security\",{\"_17\":22,\"_23\":133,\"_25\":134,\"_19\":131},\"rls/index.md\",\"rls\",{\"_17\":18,\"_19\":136},\"How To\",{\"_17\":22,\"_23\":138,\"_25\":139,\"_19\":140},\"how-to/incremental-migrations.md\",\"how-to/incremental-migrations\",\"Incremental Migrations\",{\"_17\":18,\"_19\":142},\"HTTP API\",{\"_17\":22,\"_23\":144,\"_25\":145,\"_19\":146},\"http/authorization.md\",\"http/authorization\",\"Authorization\",{\"_17\":22,\"_23\":148,\"_25\":149,\"_19\":150},\"http/identity.md\",\"http/identity\",\"`/identity`\",{\"_17\":22,\"_23\":152,\"_25\":153,\"_19\":154},\"http/database.md\",\"http/database\",\"`/database`\",{\"_17\":18,\"_19\":156},\"Internals\",{\"_17\":22,\"_23\":158,\"_25\":159,\"_19\":160},\"webassembly-abi/index.md\",\"webassembly-abi\",\"Module ABI Reference\",{\"_17\":22,\"_23\":162,\"_25\":163,\"_19\":164},\"sats-json.md\",\"sats-json\",\"SATS-JSON Data Format\",{\"_17\":22,\"_23\":166,\"_25\":167,\"_19\":168},\"bsatn.md\",\"bsatn\",\"BSATN Data Format\",{\"_17\":18,\"_19\":170},\"Appendix\",{\"_17\":22,\"_23\":172,\"_25\":173,\"_19\":170},\"appendix.md\",\"appendix\",\"rootEditURL\",\"https://github.com/clockworklabs/spacetime-docs/edit/master/docs\",\"routes/_marketing.docs.$\",{\"_178\":179,\"_180\":181,\"_182\":183,\"_184\":185},\"content\",\"\u003ch2 id=\\\"rust-client-sdk-quick-start\\\"\u003eRust Client SDK Quick Start\u003ca href=\\\"#rust-client-sdk-quick-start\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\u003cp\u003eIn this guide we\u0026#39;ll show you how to get up and running with a simple SpacetimeDB app with a client written in Rust.\u003c/p\u003e\\n\u003cp\u003eWe\u0026#39;ll implement a command-line client for the module created in our Rust or C# Module Quickstart guides. Make sure you follow one of these guides before you start on this one.\u003c/p\u003e\\n\u003ch3 id=\\\"project-structure\\\"\u003eProject structure\u003ca href=\\\"#project-structure\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eEnter the directory \u003ccode\u003equickstart-chat\u003c/code\u003e you created in the \u003ca href=\\\"/docs/modules/rust/quickstart\\\"\u003eRust Module Quickstart\u003c/a\u003e or \u003ca href=\\\"/docs/modules/c-sharp/quickstart\\\"\u003eC# Module Quickstart\u003c/a\u003e guides:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#8BE9FD\\\"\u003ecd\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e quickstart-chat\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eWithin it, create a \u003ccode\u003eclient\u003c/code\u003e crate, our client application, which users run locally:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ecargo\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e new\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e client\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"depend-on-spacetimedb-sdk-and-hex\\\"\u003eDepend on `spacetimedb-sdk` and `hex`\u003ca href=\\\"#depend-on-spacetimedb-sdk-and-hex\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eclient/Cargo.toml\u003c/code\u003e should be initialized without any dependencies. We\u0026#39;ll need two:\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e\u003ca href=\\\"https://crates.io/crates/spacetimedb-sdk\\\"\u003e\u003ccode\u003espacetimedb-sdk\u003c/code\u003e\u003c/a\u003e, which defines client-side interfaces for interacting with a remote SpacetimeDB database.\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"https://crates.io/crates/hex\\\"\u003e\u003ccode\u003ehex\u003c/code\u003e\u003c/a\u003e, which we\u0026#39;ll use to print unnamed users\u0026#39; identities as hexadecimal strings.\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cp\u003eBelow the \u003ccode\u003e[dependencies]\u003c/code\u003e line in \u003ccode\u003eclient/Cargo.toml\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#8BE9FD\\\"\u003espacetimedb-sdk\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e =\u003c/span\u003e\u003cspan style=\\\"color:#E9F284\\\"\u003e \\\"\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e1.0\u003c/span\u003e\u003cspan style=\\\"color:#E9F284\\\"\u003e\\\"\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#8BE9FD\\\"\u003ehex\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e =\u003c/span\u003e\u003cspan style=\\\"color:#E9F284\\\"\u003e \\\"\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e0.4\u003c/span\u003e\u003cspan style=\\\"color:#E9F284\\\"\u003e\\\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eMake sure you depend on the same version of \u003ccode\u003espacetimedb-sdk\u003c/code\u003e as is reported by the SpacetimeDB CLI tool\u0026#39;s \u003ccode\u003espacetime version\u003c/code\u003e!\u003c/p\u003e\\n\u003ch3 id=\\\"clear-clientsrcmainrs\\\"\u003eClear `client/src/main.rs`\u003ca href=\\\"#clear-clientsrcmainrs\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003e\u003ccode\u003eclient/src/main.rs\u003c/code\u003e should be initialized with a trivial \u0026quot;Hello world\u0026quot; program. Clear it out so we can write our chat client.\u003c/p\u003e\\n\u003cp\u003eIn your \u003ccode\u003equickstart-chat\u003c/code\u003e directory, run:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003erm\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e client/src/main.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003etouch\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e client/src/main.rs\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"generate-your-module-types\\\"\u003eGenerate your module types\u003ca href=\\\"#generate-your-module-types\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eThe \u003ccode\u003espacetime\u003c/code\u003e CLI\u0026#39;s \u003ccode\u003egenerate\u003c/code\u003e command will generate client-side interfaces for the tables, reducers and types referenced by tables or reducers defined in your server module.\u003c/p\u003e\\n\u003cp\u003eIn your \u003ccode\u003equickstart-chat\u003c/code\u003e directory, run:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003emkdir\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e -p\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e client/src/module_bindings\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003espacetime\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e generate\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e --lang\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e rust\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e --out-dir\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e client/src/module_bindings\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e --project-path\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e server\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eTake a look inside \u003ccode\u003eclient/src/module_bindings\u003c/code\u003e. The CLI should have generated a few files:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003emodule_bindings/\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── identity_connected_reducer.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── identity_disconnected_reducer.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── message_table.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── message_type.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── mod.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── send_message_reducer.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── set_name_reducer.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e├── user_table.rs\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e└── user_type.rs\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eTo use these, we\u0026#39;ll declare the module in our client crate and import its definitions.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003emod\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e module_bindings;\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003euse\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e module_bindings\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::*\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"add-more-imports\\\"\u003eAdd more imports\u003ca href=\\\"#add-more-imports\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eWe\u0026#39;ll need additional imports from \u003ccode\u003espacetimedb_sdk\u003c/code\u003e for interacting with the database, handling credentials, and managing events.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003euse\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e spacetimedb_sdk\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e{credentials, \u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eDbContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eError\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eEvent\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eIdentity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eStatus\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eTable\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eTableWithPrimaryKey\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e};\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"define-the-main-function\\\"\u003eDefine the main function\u003ca href=\\\"#define-the-main-function\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eOur \u003ccode\u003emain\u003c/code\u003e function will do the following:\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003eConnect to the database.\u003c/li\u003e\\n\u003cli\u003eRegister a number of callbacks to run in response to various database events.\u003c/li\u003e\\n\u003cli\u003eSubscribe to a set of SQL queries, whose results will be replicated and automatically updated in our client.\u003c/li\u003e\\n\u003cli\u003eSpawn a background thread where our connection will process messages and invoke callbacks.\u003c/li\u003e\\n\u003cli\u003eEnter a loop to handle user input from the command line.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003eWe\u0026#39;ll see the implementation of these functions a bit later, but for now add to \u003ccode\u003eclient/src/main.rs\u003c/code\u003e:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e main\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e() {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // Connect to the database\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    let\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e ctx \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e connect_to_db\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e();\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // Register callbacks to run in response to database events.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    register_callbacks\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ectx);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // Subscribe to SQL queries in order to construct a local partial replica of the database.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    subscribe_to_tables\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ectx);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // Spawn a thread, where the connection will process messages and invoke callbacks.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003erun_threaded\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e();\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // Handle CLI input\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    user_input_loop\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ectx);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"connect-to-the-database\\\"\u003eConnect to the database\u003ca href=\\\"#connect-to-the-database\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eA connection to a SpacetimeDB database is represented by a \u003ccode\u003eDbConnection\u003c/code\u003e. We configure \u003ccode\u003eDbConnection\u003c/code\u003es using the builder pattern, by calling \u003ccode\u003eDbConnection::builder()\u003c/code\u003e, chaining method calls to set various connection parameters and register callbacks, then we cap it off with a call to \u003ccode\u003e.build()\u003c/code\u003e to begin the connection.\u003c/p\u003e\\n\u003cp\u003eIn our case, we\u0026#39;ll supply the following options:\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003eAn \u003ccode\u003eon_connect\u003c/code\u003e callback, to run when the remote database acknowledges and accepts our connection.\u003c/li\u003e\\n\u003cli\u003eAn \u003ccode\u003eon_connect_error\u003c/code\u003e callback, to run if the remote database is unreachable or it rejects our connection.\u003c/li\u003e\\n\u003cli\u003eAn \u003ccode\u003eon_disconnect\u003c/code\u003e callback, to run when our connection ends.\u003c/li\u003e\\n\u003cli\u003eA \u003ccode\u003ewith_token\u003c/code\u003e call, to supply a token to authenticate with.\u003c/li\u003e\\n\u003cli\u003eA \u003ccode\u003ewith_module_name\u003c/code\u003e call, to specify the name or \u003ccode\u003eIdentity\u003c/code\u003e of our database. Make sure to pass the same name here as you supplied to \u003ccode\u003espacetime publish\u003c/code\u003e.\u003c/li\u003e\\n\u003cli\u003eA \u003ccode\u003ewith_uri\u003c/code\u003e call, to specify the URI of the SpacetimeDB host where our database is running.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// The URI of the SpacetimeDB instance hosting our chat database and module.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003econst\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e HOST\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003estr\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e =\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e \\\"http://localhost:3000\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e;\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// The database name we chose when we published our module.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003econst\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e DB_NAME\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003estr\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e =\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e \\\"quickstart-chat\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e;\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Load credentials from a file and connect to the database.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e connect_to_db\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e() \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e DbConnection\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e    DbConnection\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ebuilder\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // Register our `on_connect` callback, which will save our auth token.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_connect\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_connected)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // Register our `on_connect_error` callback, which will print a message, then exit the process.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_connect_error\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_connect_error)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // Our `on_disconnect` callback, which will print a message, then exit the process.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_disconnect\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_disconnected)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // If the user has previously connected, we'll have saved a token in the `on_connect` callback.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // In that case, we'll load it and pass it to `with_token`,\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // so we can re-authenticate as the same `Identity`.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ewith_token\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ecreds_store\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eload\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eexpect\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Error loading credentials\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e))\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // Set the database name we chose when we called `spacetime publish`.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ewith_module_name\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003eDB_NAME\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // Set the URI of the SpacetimeDB host that's running our database.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ewith_uri\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003eHOST\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e        // Finalize configuration and connect!\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ebuild\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eexpect\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Failed to connect\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"save-credentials\\\"\u003eSave credentials\u003ca href=\\\"#save-credentials\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eSpacetimeDB will accept any \u003ca href=\\\"https://openid.net/developers/how-connect-works/\\\"\u003eOpenID Connect\u003c/a\u003e compliant \u003ca href=\\\"https://jwt.io/\\\"\u003eJSON Web Token\u003c/a\u003e and use it to compute an \u003ccode\u003eIdentity\u003c/code\u003e for the user. More complex applications will generally authenticate their user somehow, generate or retrieve a token, and attach it to their connection via \u003ccode\u003ewith_token\u003c/code\u003e. In our case, though, we\u0026#39;ll connect anonymously the first time, let SpacetimeDB generate a fresh \u003ccode\u003eIdentity\u003c/code\u003e and corresponding JWT for us, and save that token locally to re-use the next time we connect.\u003c/p\u003e\\n\u003cp\u003eThe Rust SDK provides a pair of functions in \u003ccode\u003eFile\u003c/code\u003e, \u003ccode\u003esave\u003c/code\u003e and \u003ccode\u003eload\u003c/code\u003e, for saving and storing these credentials in a file. By default the \u003ccode\u003esave\u003c/code\u003e and \u003ccode\u003eload\u003c/code\u003e will look for credentials in the \u003ccode\u003e$HOME/.spacetimedb_client_credentials/\u003c/code\u003e directory, which should be unintrusive. If saving our credentials fails, we\u0026#39;ll print a message to standard error, but otherwise continue; even though the user won\u0026#39;t be able to reconnect with the same identity, they can still chat normally.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e creds_store\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e() \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e credentials\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eFile\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    credentials\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eFile\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003enew\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"quickstart-chat\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `on_connect` callback: save our credentials to a file.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_connected\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(_ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eDbConnection\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, _identity\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, token\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003estr\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e let\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Err\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(e) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e creds_store\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003esave\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(token) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        eprintln!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Failed to save credentials: {:?}\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"handle-errors-and-disconnections\\\"\u003eHandle errors and disconnections\u003ca href=\\\"#handle-errors-and-disconnections\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eWe need to handle connection errors and disconnections by printing appropriate messages and exiting the program. These callbacks take an \u003ccode\u003eErrorContext\u003c/code\u003e, a \u003ccode\u003eDbConnection\u003c/code\u003e that\u0026#39;s been augmented with information about the error that occured.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `on_connect_error` callback: print the error, then exit the process.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_connect_error\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(_ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eErrorContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, err\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Error\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    eprintln!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Connection error: {:?}\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, err);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    std\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eprocess\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eexit\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e1\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `on_disconnect` callback: print a note, then exit the process.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_disconnected\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(_ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eErrorContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, err\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Option\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eError\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e let\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Some\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(err) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e err {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        eprintln!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Disconnected: {}\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, err);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e        std\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eprocess\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eexit\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e1\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    } \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003eelse\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Disconnected.\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e        std\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eprocess\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eexit\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e0\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"register-callbacks\\\"\u003eRegister callbacks\u003ca href=\\\"#register-callbacks\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eWe need to handle several sorts of events:\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003eWhen a new user joins, we\u0026#39;ll print a message introducing them.\u003c/li\u003e\\n\u003cli\u003eWhen a user is updated, we\u0026#39;ll print their new name, or declare their new online status.\u003c/li\u003e\\n\u003cli\u003eWhen we receive a new message, we\u0026#39;ll print it.\u003c/li\u003e\\n\u003cli\u003eIf the server rejects our attempt to set our name, we\u0026#39;ll print an error.\u003c/li\u003e\\n\u003cli\u003eIf the server rejects a message we send, we\u0026#39;ll print an error.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Register all the callbacks our app will use to respond to database events.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e register_callbacks\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eDbConnection\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // When a new user joins, print a notification.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003edb\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003euser\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_insert\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_user_inserted);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // When a user's status changes, print a notification.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003edb\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003euser\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_update\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_user_updated);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // When a new message is received, print it.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003edb\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003emessage\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_insert\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_message_inserted);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // When we fail to set our name, print a warning.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ereducers\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_set_name\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_name_set);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e    // When we fail to send a message, print a warning.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ereducers\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_send_message\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_message_sent);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"notify-about-new-users\\\"\u003eNotify about new users\u003ca href=\\\"#notify-about-new-users\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eFor each table, we can register on-insert and on-delete callbacks to be run whenever a subscribed row is inserted or deleted. We register these callbacks using the \u003ccode\u003eon_insert\u003c/code\u003e and \u003ccode\u003eon_delete\u003c/code\u003e, which is automatically implemented for each table by \u003ccode\u003espacetime generate\u003c/code\u003e.\u003c/p\u003e\\n\u003cp\u003eThese callbacks can fire in several contexts, of which we care about two:\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003eAfter a reducer runs, when the client\u0026#39;s cache is updated about changes to subscribed rows.\u003c/li\u003e\\n\u003cli\u003eAfter calling \u003ccode\u003esubscribe\u003c/code\u003e, when the client\u0026#39;s cache is initialized with all existing matching rows.\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cp\u003eThis second case means that, even though the module only ever inserts online users, the client\u0026#39;s \u003ccode\u003econn.db.user().on_insert(..)\u003c/code\u003e callbacks may be invoked with users who are offline. We\u0026#39;ll only notify about online users.\u003c/p\u003e\\n\u003cp\u003e\u003ccode\u003eon_insert\u003c/code\u003e and \u003ccode\u003eon_delete\u003c/code\u003e callbacks take two arguments: an \u003ccode\u003e\u0026amp;EventContext\u003c/code\u003e and the modified row. Like the \u003ccode\u003eErrorContext\u003c/code\u003e above, \u003ccode\u003eEventContext\u003c/code\u003e is a \u003ccode\u003eDbConnection\u003c/code\u003e that\u0026#39;s been augmented with information about the event that caused the row to be modified. You can determine whether the insert/delete operation was caused by a reducer, a newly-applied subscription, or some other event by pattern-matching on \u003ccode\u003ectx.event\u003c/code\u003e.\u003c/p\u003e\\n\u003cp\u003eWhenever we want to print a user, if they have set a name, we\u0026#39;ll use that. If they haven\u0026#39;t set a name, we\u0026#39;ll instead print the first 8 bytes of their identity, encoded as hexadecimal. We\u0026#39;ll define functions \u003ccode\u003euser_name_or_identity\u003c/code\u003e and \u003ccode\u003eidentity_leading_hex\u003c/code\u003e to handle this.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `User::on_insert` callback:\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// if the user is online, print a notification.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_user_inserted\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(_ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eEventContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, user\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eUser\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e user\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eonline {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"User {} connected.\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003euser_name_or_identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(user));\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e user_name_or_identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(user\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eUser\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e String\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    user\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ename\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eclone\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eunwrap_or_else\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e||\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e user\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eidentity\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eto_hex\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eto_string\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e())\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"notify-about-updated-users\\\"\u003eNotify about updated users\u003ca href=\\\"#notify-about-updated-users\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eBecause we declared a \u003ccode\u003e#[primary_key]\u003c/code\u003e column in our \u003ccode\u003eUser\u003c/code\u003e table, we can also register on-update callbacks. These run whenever a row is replaced by a row with the same primary key, like our module\u0026#39;s \u003ccode\u003ectx.db.user().identity().update(..)\u003c/code\u003e calls. We register these callbacks using the \u003ccode\u003eon_update\u003c/code\u003e method of the trait \u003ccode\u003eTableWithPrimaryKey\u003c/code\u003e, which is automatically implemented by \u003ccode\u003espacetime generate\u003c/code\u003e for any table with a \u003ccode\u003e#[primary_key]\u003c/code\u003e column.\u003c/p\u003e\\n\u003cp\u003e\u003ccode\u003eon_update\u003c/code\u003e callbacks take three arguments: the \u003ccode\u003e\u0026amp;EventContext\u003c/code\u003e, the old row, and the new row.\u003c/p\u003e\\n\u003cp\u003eIn our module, users can be updated for three reasons:\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003eThey\u0026#39;ve set their name using the \u003ccode\u003eset_name\u003c/code\u003e reducer.\u003c/li\u003e\\n\u003cli\u003eThey\u0026#39;re an existing user re-connecting, so their \u003ccode\u003eonline\u003c/code\u003e has been set to \u003ccode\u003etrue\u003c/code\u003e.\u003c/li\u003e\\n\u003cli\u003eThey\u0026#39;ve disconnected, so their \u003ccode\u003eonline\u003c/code\u003e has been set to \u003ccode\u003efalse\u003c/code\u003e.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003eWe\u0026#39;ll print an appropriate message in each of these cases.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `User::on_update` callback:\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// print a notification about name and status changes.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_user_updated\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(_ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eEventContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, old\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eUser\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, new\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eUser\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e old\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ename \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e!=\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e new\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ename {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e            \\\"User {} renamed to {}.\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e,\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e            user_name_or_identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(old),\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e            user_name_or_identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(new)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e        );\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e old\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eonline \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e !\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003enew\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eonline {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"User {} disconnected.\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003euser_name_or_identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(new));\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e !\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eold\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eonline \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e new\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eonline {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"User {} connected.\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003euser_name_or_identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(new));\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"print-messages\\\"\u003ePrint messages\u003ca href=\\\"#print-messages\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eWhen we receive a new message, we\u0026#39;ll print it to standard output, along with the name of the user who sent it. Keep in mind that we only want to do this for new messages, i.e. those inserted by a \u003ccode\u003esend_message\u003c/code\u003e reducer invocation. We have to handle the backlog we receive when our subscription is initialized separately, to ensure they\u0026#39;re printed in the correct order. To that effect, our \u003ccode\u003eon_message_inserted\u003c/code\u003e callback will check if the ctx.event type is an \u003ccode\u003eEvent::Reducer\u003c/code\u003e, and only print in that case.\u003c/p\u003e\\n\u003cp\u003eTo find the \u003ccode\u003eUser\u003c/code\u003e based on the message\u0026#39;s \u003ccode\u003esender\u003c/code\u003e identity, we\u0026#39;ll use \u003ccode\u003ectx.db.user().identity().find(..)\u003c/code\u003e, which behaves like the same function on the server.\u003c/p\u003e\\n\u003cp\u003eWe\u0026#39;ll print the user\u0026#39;s name or identity in the same way as we did when notifying about \u003ccode\u003eUser\u003c/code\u003e table events, but here we have to handle the case where we don\u0026#39;t find a matching \u003ccode\u003eUser\u003c/code\u003e row. This can happen when the module owner sends a message using the CLI\u0026#39;s \u003ccode\u003espacetime call\u003c/code\u003e. In this case, we\u0026#39;ll print \u003ccode\u003eunknown\u003c/code\u003e.\u003c/p\u003e\\n\u003cp\u003eNotice that our \u003ccode\u003eprint_message\u003c/code\u003e function takes an \u003ccode\u003e\u0026amp;impl RemoteDbContext\u003c/code\u003e as an argument. This is a trait, defined in our \u003ccode\u003emodule_bindings\u003c/code\u003e by \u003ccode\u003espacetime generate\u003c/code\u003e, which is implemented by \u003ccode\u003eDbConnection\u003c/code\u003e, \u003ccode\u003eEventContext\u003c/code\u003e, \u003ccode\u003eErrorContext\u003c/code\u003e and a few other similar types. (\u003ccode\u003eRemoteDbContext\u003c/code\u003e is actually a shorthand for \u003ccode\u003eDbContext\u003c/code\u003e, which applies to connections to \u003cem\u003eany\u003c/em\u003e module, with its associated types locked to module-specific ones.) Later on, we\u0026#39;re going to call \u003ccode\u003eprint_message\u003c/code\u003e with a \u003ccode\u003eReducerEventContext\u003c/code\u003e, so we need to be more generic than just accepting \u003ccode\u003eEventContext\u003c/code\u003e.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `Message::on_insert` callback: print new messages.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_message_inserted\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eEventContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, message\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eMessage\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e let\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Event\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eReducer\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(_) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eevent {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        print_message\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx, message)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e print_message\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;impl\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e RemoteDbContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, message\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eMessage\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    let\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e sender \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e ctx\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003edb\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003euser\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eidentity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003efind\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003emessage\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003esender\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eclone\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e())\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003emap\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e|\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eu\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e|\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e user_name_or_identity\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eu))\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eunwrap_or_else\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e||\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e \\\"unknown\\\"\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eto_string\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e());\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"{}: {}\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, sender, message\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003etext);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"handle-reducer-failures\\\"\u003eHandle reducer failures\u003ca href=\\\"#handle-reducer-failures\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eWe can also register callbacks to run each time a reducer is invoked. We register these callbacks using the \u003ccode\u003eon_reducer\u003c/code\u003e method of the \u003ccode\u003eReducer\u003c/code\u003e trait, which is automatically implemented for each reducer by \u003ccode\u003espacetime generate\u003c/code\u003e.\u003c/p\u003e\\n\u003cp\u003eEach reducer callback first takes a \u003ccode\u003e\u0026amp;ReducerEventContext\u003c/code\u003e which contains metadata about the reducer call, including the identity of the caller and whether or not the reducer call suceeded.\u003c/p\u003e\\n\u003cp\u003eThese callbacks will be invoked in one of two cases:\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003eIf the reducer was successful and altered any of our subscribed rows.\u003c/li\u003e\\n\u003cli\u003eIf we requested an invocation which failed.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003eNote that a status of \u003ccode\u003eFailed\u003c/code\u003e or \u003ccode\u003eOutOfEnergy\u003c/code\u003e implies that the caller identity is our own identity.\u003c/p\u003e\\n\u003cp\u003eWe already handle successful \u003ccode\u003eset_name\u003c/code\u003e invocations using our \u003ccode\u003ectx.db.user().on_update(..)\u003c/code\u003e callback, but if the module rejects a user\u0026#39;s chosen name, we\u0026#39;d like that user\u0026#39;s client to let them know. We define a function \u003ccode\u003eon_set_name\u003c/code\u003e as a \u003ccode\u003econn.reducers.on_set_name(..)\u003c/code\u003e callback which checks if the reducer failed, and if it did, prints a message including the rejected name and the error.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `on_set_name` callback: print a warning if the reducer failed.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_name_set\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eReducerEventContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, name\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eString\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e let\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Status\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eFailed\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(err) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ectx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eevent\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003estatus {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        eprintln!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Failed to change name to {:?}: {}\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, name, err);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `on_send_message` callback: print a warning if the reducer failed.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_message_sent\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eReducerEventContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, text\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eString\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    if\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e let\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Status\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eFailed\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(err) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ectx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eevent\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003estatus {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        eprintln!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Failed to send message {:?}: {}\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, text, err);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"subscribe-to-queries\\\"\u003eSubscribe to queries\u003ca href=\\\"#subscribe-to-queries\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eSpacetimeDB is set up so that each client subscribes via SQL queries to some subset of the database, and is notified about changes only to that subset. For complex apps with large databases, judicious subscriptions can save each client significant network bandwidth, memory and computation. For example, in \u003ca href=\\\"https://bitcraftonline.com\\\"\u003eBitCraft\u003c/a\u003e, each player\u0026#39;s client subscribes only to the entities in the \u0026quot;chunk\u0026quot; of the world where that player currently resides, rather than the entire game world. Our app is much simpler than BitCraft, so we\u0026#39;ll just subscribe to the whole database.\u003c/p\u003e\\n\u003cp\u003eWhen we specify our subscriptions, we can supply an \u003ccode\u003eon_applied\u003c/code\u003e callback. This will run when the subscription is applied and the matching rows become available in our client cache. We\u0026#39;ll use this opportunity to print the message backlog in proper order.\u003c/p\u003e\\n\u003cp\u003eWe\u0026#39;ll also provide an \u003ccode\u003eon_error\u003c/code\u003e callback. This will run if the subscription fails, usually due to an invalid or malformed SQL queries. We can\u0026#39;t handle this case, so we\u0026#39;ll just print out the error and exit the process.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Register subscriptions for all rows of both tables.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e subscribe_to_tables\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eDbConnection\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003esubscription_builder\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_applied\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_sub_applied)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eon_error\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(on_sub_error)\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        .\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003esubscribe\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e([\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"SELECT * FROM user\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, \u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"SELECT * FROM message\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e]);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"print-past-messages-in-order\\\"\u003ePrint past messages in order\u003ca href=\\\"#print-past-messages-in-order\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eMessages we receive live will come in order, but when we connect, we\u0026#39;ll receive all the past messages at once. We can\u0026#39;t just print these in the order we receive them; the logs would be all shuffled around, and would make no sense. Instead, when we receive the log of past messages, we\u0026#39;ll sort them by their sent timestamps and print them in order.\u003c/p\u003e\\n\u003cp\u003eWe\u0026#39;ll handle this in our function \u003ccode\u003eprint_messages_in_order\u003c/code\u003e, which we registered as an \u003ccode\u003eon_applied\u003c/code\u003e callback. \u003ccode\u003eprint_messages_in_order\u003c/code\u003e iterates over all the \u003ccode\u003eMessage\u003c/code\u003es we\u0026#39;ve received, sorts them, and then prints them. \u003ccode\u003ectx.db.message().iter()\u003c/code\u003e is defined on the trait \u003ccode\u003eTable\u003c/code\u003e, and returns an iterator over all the messages in the client cache. Rust iterators can\u0026#39;t be sorted in-place, so we\u0026#39;ll collect it to a \u003ccode\u003eVec\u003c/code\u003e, then use the \u003ccode\u003esort_by_key\u003c/code\u003e method to sort by timestamp.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Our `on_subscription_applied` callback:\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// sort all past messages and print them in timestamp order.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_sub_applied\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eSubscriptionEventContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    let\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e mut\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e messages \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003edb\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003emessage\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eiter\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ecollect\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eVec\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e\u0026#x3C;_\u003e\u003e();\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    messages\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003esort_by_key\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e|\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003em\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e|\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e m\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003esent);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    for\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e message \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003ein\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e messages {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e        print_message\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx, \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003emessage);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Fully connected and all subscriptions applied.\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    println!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Use /name to set your name, or type a message!\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch4 id=\\\"notify-about-failed-subscriptions\\\"\u003eNotify about failed subscriptions\u003ca href=\\\"#notify-about-failed-subscriptions\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\u003cp\u003eIt\u0026#39;s possible for SpacetimeDB to reject subscriptions. This happens most often because of a typo in the SQL queries, but can be due to use of SQL features that SpacetimeDB doesn\u0026#39;t support. See \u003ca href=\\\"/docs/sql#subscriptions\\\"\u003eSQL Support: Subscriptions\u003c/a\u003e for more information about what subscription queries SpacetimeDB supports.\u003c/p\u003e\\n\u003cp\u003eIn our case, we\u0026#39;re pretty confident that our queries are valid, but if SpacetimeDB rejects them, we want to know about it. Our callback will print the error, then exit the process.\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Or `on_error` callback:\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// print the error, then exit the process.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e on_sub_error\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(_ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eErrorContext\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, err\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Error\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e    eprintln!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Subscription failed: {}\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e, err);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    std\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eprocess\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eexit\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#BD93F9\\\"\u003e1\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"handle-user-input\\\"\u003eHandle user input\u003ca href=\\\"#handle-user-input\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eOur app should allow the user to interact by typing lines into their terminal. If the line starts with \u003ccode\u003e/name \u003c/code\u003e, we\u0026#39;ll change the user\u0026#39;s name. Any other line will send a message.\u003c/p\u003e\\n\u003cp\u003eFor each reducer defined by our module, \u003ccode\u003ectx.reducers\u003c/code\u003e has a method to request an invocation. In our case, we pass \u003ccode\u003eset_name\u003c/code\u003e and \u003ccode\u003esend_message\u003c/code\u003e a \u003ccode\u003eString\u003c/code\u003e, which gets sent to the server to execute the corresponding reducer.\u003c/p\u003e\\n\u003cp\u003eTo \u003ccode\u003eclient/src/main.rs\u003c/code\u003e, add:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#6272A4\\\"\u003e/// Read each line of standard input, and either set our name or send a message as appropriate.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003efn\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e user_input_loop\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e:\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003eDbConnection\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e    for\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e line \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003ein\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e std\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003eio\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e::\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003estdin\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003elines\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e() {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        let\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Ok\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(line) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e line \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003eelse\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003e            panic!\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"Failed to read from stdin.\\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e);\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e        };\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e        if\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e let\u003c/span\u003e\u003cspan style=\\\"color:#8BE9FD;font-style:italic\\\"\u003e Some\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(name) \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e=\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e line\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003estrip_prefix\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e\\\"/name \\\"\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e            ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ereducers\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eset_name\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(name\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eto_string\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e())\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eunwrap\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e();\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e        } \u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003eelse\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e            ctx\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003ereducers\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003esend_message\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e(line)\u003c/span\u003e\u003cspan style=\\\"color:#FF79C6\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003eunwrap\u003c/span\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e();\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e        }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e    }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#F8F8F2\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"run-it\\\"\u003eRun it\u003ca href=\\\"#run-it\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eAfter setting everything up, change your directory to the client app, then compile and run it. From the \u003ccode\u003equickstart-chat\u003c/code\u003e directory, run:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#8BE9FD\\\"\u003ecd\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e client\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#50FA7B\\\"\u003ecargo\u003c/span\u003e\u003cspan style=\\\"color:#F1FA8C\\\"\u003e run\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eYou should see something like:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003eUser d9e25c51996dea2f connected.\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eNow try sending a message by typing \u003ccode\u003eHello, world!\u003c/code\u003e and pressing enter. You should see:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003ed9e25c51996dea2f: Hello, world!\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eNext, set your name by typing \u003ccode\u003e/name \u0026lt;my-name\u0026gt;\u003c/code\u003e, replacing \u003ccode\u003e\u0026lt;my-name\u0026gt;\u003c/code\u003e with your desired username. You should see:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003eUser d9e25c51996dea2f renamed to \u0026#x3C;my-name\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eThen, send another message:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e\u0026#x3C;my-name\u003e: Hello after naming myself.\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003cp\u003eNow, close the app by hitting \u003ccode\u003eCtrl+C\u003c/code\u003e, and start it again with \u003ccode\u003ecargo run\u003c/code\u003e. You\u0026#39;ll see yourself connecting, and your past messages will load in order:\u003c/p\u003e\\n\\n\u003cpre class=\\\"shiki spacetime-dark\\\" style=\\\"background-color:var(--color-bg);color:#F8F8F2\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003eUser \u0026#x3C;my-name\u003e connected.\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e\u0026#x3C;my-name\u003e: Hello, world!\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan\u003e\u0026#x3C;my-name\u003e: Hello after naming myself.\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e \u003cbutton data-copy-code\u003e\\n    \u003csvg\\n        class=\\\"md-copy-icon\\\"\\n        xmlns=\\\"http://www.w3.org/2000/svg\\\"\\n        width=\\\"24\\\"\\n        height=\\\"24\\\"\\n        viewBox=\\\"0 0 24 24\\\"\\n    \u003e\\n        \u003cg fill=\\\"white\\\"\u003e\\n            \u003cpath d=\\\"M15.24 2h-3.894c-1.764 0-3.162 0-4.255.148c-1.126.152-2.037.472-2.755 1.193c-.719.721-1.038 1.636-1.189 2.766C3 7.205 3 8.608 3 10.379v5.838c0 1.508.92 2.8 2.227 3.342c-.067-.91-.067-2.185-.067-3.247v-5.01c0-1.281 0-2.386.118-3.27c.127-.948.413-1.856 1.147-2.593c.734-.737 1.639-1.024 2.583-1.152c.88-.118 1.98-.118 3.257-.118h3.07c1.276 0 2.374 0 3.255.118A3.601 3.601 0 0 0 15.24 2Z\\\" /\u003e\\n            \u003cpath d=\\\"M6.6 11.397c0-2.726 0-4.089.844-4.936c.843-.847 2.2-.847 4.916-.847h2.88c2.715 0 4.073 0 4.917.847c.843.847.843 2.21.843 4.936v4.82c0 2.726 0 4.089-.843 4.936c-.844.847-2.202.847-4.917.847h-2.88c-2.715 0-4.073 0-4.916-.847c-.844-.847-.844-2.21-.844-4.936v-4.82Z\\\" /\u003e\\n        \u003c/g\u003e\\n    \u003c/svg\u003e\\n\u003c/button\u003e\u003c/pre\u003e\u003ch3 id=\\\"whats-next\\\"\u003eWhat's next?\u003ca href=\\\"#whats-next\\\" class=\\\"permalink\\\"\u003e\u003cspan class=\\\"visually-hidden\\\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eYou can find the full code for this client \u003ca href=\\\"https://github.com/clockworklabs/SpacetimeDB/tree/master/crates/sdk/examples/quickstart-chat\\\"\u003ein the Rust client SDK\u0026#39;s examples\u003c/a\u003e.\u003c/p\u003e\\n\u003cp\u003eCheck out the \u003ca href=\\\"/docs/sdks/rust\\\"\u003eRust client SDK Reference\u003c/a\u003e for a more comprehensive view of the SpacetimeDB Rust client SDK.\u003c/p\u003e\\n\u003cp\u003eOur basic terminal interface has some limitations. Incoming messages can appear while the user is typing, which is less than ideal. Additionally, the user\u0026#39;s input gets mixed with the program\u0026#39;s output, making messages the user sends appear twice. You might want to try improving the interface by using \u003ca href=\\\"https://crates.io/crates/rustyline\\\"\u003eRustyline\u003c/a\u003e, \u003ca href=\\\"https://crates.io/crates/cursive\\\"\u003eCursive\u003c/a\u003e, or even creating a full-fledged GUI.\u003c/p\u003e\\n\u003cp\u003eOnce your chat server runs for a while, you might want to limit the messages your client loads by refining your \u003ccode\u003eMessage\u003c/code\u003e subscription query, only subscribing to messages sent within the last half-hour.\u003c/p\u003e\\n\u003cp\u003eYou could also add features like:\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003eStyling messages by interpreting HTML tags and printing appropriate \u003ca href=\\\"https://en.wikipedia.org/wiki/ANSI_escape_code\\\"\u003eANSI escapes\u003c/a\u003e.\u003c/li\u003e\\n\u003cli\u003eAdding a \u003ccode\u003emoderator\u003c/code\u003e flag to the \u003ccode\u003eUser\u003c/code\u003e table, allowing moderators to manage users (e.g., time-out, ban).\u003c/li\u003e\\n\u003cli\u003eAdding rooms or channels that users can join or leave.\u003c/li\u003e\\n\u003cli\u003eSupporting direct messages or displaying user statuses next to their usernames.\u003c/li\u003e\\n\u003c/ul\u003e\\n\",\"next\",{\"_17\":22,\"_23\":108,\"_25\":109,\"_19\":84},\"prev\",{\"_17\":22,\"_23\":102,\"_25\":103,\"_19\":92},\"editURL\",\"https://github.com/clockworklabs/spacetime-docs/edit/master/docs/sdks/rust/quickstart.md\",\"routes/_marketing\",\"actionData\",\"errors\"]\n");</script><!--$--><script>window.__remixContext.streamController.close();</script><!--/$--><!--/$-->